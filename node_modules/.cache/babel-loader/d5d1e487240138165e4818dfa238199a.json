{"ast":null,"code":"import _regeneratorRuntime from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{MaxUint256}from'@ethersproject/constants';import{sendAnalyticsEvent}from'@uniswap/analytics';import{EventName}from'@uniswap/analytics-events';import{useWeb3React}from'@web3-react/core';import{useTokenContract}from'hooks/useContract';import{useTokenAllowance}from'hooks/useTokenAllowance';import{getTokenAddress}from'lib/utils/analytics';import{useCallback,useMemo}from'react';import{calculateGasMargin}from'utils/calculateGasMargin';export var ApprovalState;(function(ApprovalState){ApprovalState[\"UNKNOWN\"]=\"UNKNOWN\";ApprovalState[\"NOT_APPROVED\"]=\"NOT_APPROVED\";ApprovalState[\"PENDING\"]=\"PENDING\";ApprovalState[\"APPROVED\"]=\"APPROVED\";})(ApprovalState||(ApprovalState={}));function useApprovalStateForSpender(amountToApprove,spender,useIsPendingApproval){var _amountToApprove$curr;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var token=(amountToApprove===null||amountToApprove===void 0?void 0:(_amountToApprove$curr=amountToApprove.currency)===null||_amountToApprove$curr===void 0?void 0:_amountToApprove$curr.isToken)?amountToApprove.currency:undefined;var _useTokenAllowance=useTokenAllowance(token,account!==null&&account!==void 0?account:undefined,spender),tokenAllowance=_useTokenAllowance.tokenAllowance;var pendingApproval=useIsPendingApproval(token,spender);return useMemo(function(){if(!amountToApprove||!spender)return ApprovalState.UNKNOWN;if(amountToApprove.currency.isNative)return ApprovalState.APPROVED;// we might not have enough data to know whether or not we need to approve\nif(!tokenAllowance)return ApprovalState.UNKNOWN;// amountToApprove will be defined if tokenAllowance is\nreturn tokenAllowance.lessThan(amountToApprove)?pendingApproval?ApprovalState.PENDING:ApprovalState.NOT_APPROVED:ApprovalState.APPROVED;},[amountToApprove,pendingApproval,spender,tokenAllowance]);}export function useApproval(amountToApprove,spender,useIsPendingApproval){var _amountToApprove$curr2;var _useWeb3React2=useWeb3React(),chainId=_useWeb3React2.chainId;var token=(amountToApprove===null||amountToApprove===void 0?void 0:(_amountToApprove$curr2=amountToApprove.currency)===null||_amountToApprove$curr2===void 0?void 0:_amountToApprove$curr2.isToken)?amountToApprove.currency:undefined;// check the current approval status\nvar approvalState=useApprovalStateForSpender(amountToApprove,spender,useIsPendingApproval);var tokenContract=useTokenContract(token===null||token===void 0?void 0:token.address);var approve=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var logFailure,useExact,estimatedGas;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:logFailure=function _logFailure(error){console.warn(\"\".concat((token===null||token===void 0?void 0:token.symbol)||'Token',\" approval failed:\"),error);return;};if(!(approvalState!==ApprovalState.NOT_APPROVED)){_context.next=5;break;}return _context.abrupt(\"return\",logFailure('approve was called unnecessarily'));case 5:if(chainId){_context.next=9;break;}return _context.abrupt(\"return\",logFailure('no chainId'));case 9:if(token){_context.next=13;break;}return _context.abrupt(\"return\",logFailure('no token'));case 13:if(tokenContract){_context.next=17;break;}return _context.abrupt(\"return\",logFailure('tokenContract is null'));case 17:if(amountToApprove){_context.next=21;break;}return _context.abrupt(\"return\",logFailure('missing amount to approve'));case 21:if(spender){_context.next=23;break;}return _context.abrupt(\"return\",logFailure('no spender'));case 23:useExact=false;_context.next=26;return tokenContract.estimateGas.approve(spender,MaxUint256).catch(function(){// general fallback for tokens which restrict approval amounts\nuseExact=true;return tokenContract.estimateGas.approve(spender,amountToApprove.quotient.toString());});case 26:estimatedGas=_context.sent;return _context.abrupt(\"return\",tokenContract.approve(spender,useExact?amountToApprove.quotient.toString():MaxUint256,{gasLimit:calculateGasMargin(estimatedGas)}).then(function(response){var eventProperties={chain_id:chainId,token_symbol:token===null||token===void 0?void 0:token.symbol,token_address:getTokenAddress(token)};sendAnalyticsEvent(EventName.APPROVE_TOKEN_TXN_SUBMITTED,eventProperties);return{response:response,tokenAddress:token.address,spenderAddress:spender};}).catch(function(error){logFailure(error);throw error;}));case 28:case\"end\":return _context.stop();}}},_callee);})),[approvalState,token,tokenContract,amountToApprove,spender,chainId]);return[approvalState,approve];}","map":{"version":3,"names":["MaxUint256","sendAnalyticsEvent","EventName","useWeb3React","useTokenContract","useTokenAllowance","getTokenAddress","useCallback","useMemo","calculateGasMargin","ApprovalState","useApprovalStateForSpender","amountToApprove","spender","useIsPendingApproval","account","token","currency","isToken","undefined","tokenAllowance","pendingApproval","UNKNOWN","isNative","APPROVED","lessThan","PENDING","NOT_APPROVED","useApproval","chainId","approvalState","tokenContract","address","approve","logFailure","error","console","warn","symbol","useExact","estimateGas","catch","quotient","toString","estimatedGas","gasLimit","then","response","eventProperties","chain_id","token_symbol","token_address","APPROVE_TOKEN_TXN_SUBMITTED","tokenAddress","spenderAddress"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/lib/hooks/useApproval.ts"],"sourcesContent":["import { MaxUint256 } from '@ethersproject/constants'\nimport type { TransactionResponse } from '@ethersproject/providers'\nimport { sendAnalyticsEvent } from '@uniswap/analytics'\nimport { EventName } from '@uniswap/analytics-events'\nimport { Currency, CurrencyAmount, Token } from '@uniswap/sdk-core'\nimport { useWeb3React } from '@web3-react/core'\nimport { useTokenContract } from 'hooks/useContract'\nimport { useTokenAllowance } from 'hooks/useTokenAllowance'\nimport { getTokenAddress } from 'lib/utils/analytics'\nimport { useCallback, useMemo } from 'react'\nimport { calculateGasMargin } from 'utils/calculateGasMargin'\n\nexport enum ApprovalState {\n  UNKNOWN = 'UNKNOWN',\n  NOT_APPROVED = 'NOT_APPROVED',\n  PENDING = 'PENDING',\n  APPROVED = 'APPROVED',\n}\n\nfunction useApprovalStateForSpender(\n  amountToApprove: CurrencyAmount<Currency> | undefined,\n  spender: string | undefined,\n  useIsPendingApproval: (token?: Token, spender?: string) => boolean\n): ApprovalState {\n  const { account } = useWeb3React()\n  const token = amountToApprove?.currency?.isToken ? amountToApprove.currency : undefined\n\n  const { tokenAllowance } = useTokenAllowance(token, account ?? undefined, spender)\n  const pendingApproval = useIsPendingApproval(token, spender)\n\n  return useMemo(() => {\n    if (!amountToApprove || !spender) return ApprovalState.UNKNOWN\n    if (amountToApprove.currency.isNative) return ApprovalState.APPROVED\n    // we might not have enough data to know whether or not we need to approve\n    if (!tokenAllowance) return ApprovalState.UNKNOWN\n\n    // amountToApprove will be defined if tokenAllowance is\n    return tokenAllowance.lessThan(amountToApprove)\n      ? pendingApproval\n        ? ApprovalState.PENDING\n        : ApprovalState.NOT_APPROVED\n      : ApprovalState.APPROVED\n  }, [amountToApprove, pendingApproval, spender, tokenAllowance])\n}\n\nexport function useApproval(\n  amountToApprove: CurrencyAmount<Currency> | undefined,\n  spender: string | undefined,\n  useIsPendingApproval: (token?: Token, spender?: string) => boolean\n): [\n  ApprovalState,\n  () => Promise<{ response: TransactionResponse; tokenAddress: string; spenderAddress: string } | undefined>\n] {\n  const { chainId } = useWeb3React()\n  const token = amountToApprove?.currency?.isToken ? amountToApprove.currency : undefined\n\n  // check the current approval status\n  const approvalState = useApprovalStateForSpender(amountToApprove, spender, useIsPendingApproval)\n\n  const tokenContract = useTokenContract(token?.address)\n\n  const approve = useCallback(async () => {\n    function logFailure(error: Error | string): undefined {\n      console.warn(`${token?.symbol || 'Token'} approval failed:`, error)\n      return\n    }\n\n    // Bail early if there is an issue.\n    if (approvalState !== ApprovalState.NOT_APPROVED) {\n      return logFailure('approve was called unnecessarily')\n    } else if (!chainId) {\n      return logFailure('no chainId')\n    } else if (!token) {\n      return logFailure('no token')\n    } else if (!tokenContract) {\n      return logFailure('tokenContract is null')\n    } else if (!amountToApprove) {\n      return logFailure('missing amount to approve')\n    } else if (!spender) {\n      return logFailure('no spender')\n    }\n\n    let useExact = false\n    const estimatedGas = await tokenContract.estimateGas.approve(spender, MaxUint256).catch(() => {\n      // general fallback for tokens which restrict approval amounts\n      useExact = true\n      return tokenContract.estimateGas.approve(spender, amountToApprove.quotient.toString())\n    })\n\n    return tokenContract\n      .approve(spender, useExact ? amountToApprove.quotient.toString() : MaxUint256, {\n        gasLimit: calculateGasMargin(estimatedGas),\n      })\n      .then((response) => {\n        const eventProperties = {\n          chain_id: chainId,\n          token_symbol: token?.symbol,\n          token_address: getTokenAddress(token),\n        }\n        sendAnalyticsEvent(EventName.APPROVE_TOKEN_TXN_SUBMITTED, eventProperties)\n        return {\n          response,\n          tokenAddress: token.address,\n          spenderAddress: spender,\n        }\n      })\n      .catch((error: Error) => {\n        logFailure(error)\n        throw error\n      })\n  }, [approvalState, token, tokenContract, amountToApprove, spender, chainId])\n\n  return [approvalState, approve]\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}