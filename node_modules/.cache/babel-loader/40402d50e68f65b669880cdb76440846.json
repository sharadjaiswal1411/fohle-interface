{"ast":null,"code":"import { logger, getEventDescription, stringMatchesSomePattern } from '@sentry/utils';\n\n// \"Script error.\" is hard coded into browsers for errors that it can't read.\n// this is the result of a script being pulled in from an external domain and CORS.\nconst DEFAULT_IGNORE_ERRORS = [/^Script error\\.?$/, /^Javascript error: Script error\\.? on line 0$/];\n\n/** Options for the InboundFilters integration */\n\n/** Inbound filters configurable by the user */\nclass InboundFilters {\n  /**\n   * @inheritDoc\n   */\n  static __initStatic() {\n    this.id = 'InboundFilters';\n  }\n\n  /**\n   * @inheritDoc\n   */\n  __init() {\n    this.name = InboundFilters.id;\n  }\n  constructor() {\n    let _options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    ;\n    this._options = _options;\n    InboundFilters.prototype.__init.call(this);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  setupOnce(addGlobalEventProcessor, getCurrentHub) {\n    const eventProcess = event => {\n      const hub = getCurrentHub();\n      if (hub) {\n        const self = hub.getIntegration(InboundFilters);\n        if (self) {\n          const client = hub.getClient();\n          const clientOptions = client ? client.getOptions() : {};\n          const options = _mergeOptions(self._options, clientOptions);\n          return _shouldDropEvent(event, options) ? null : event;\n        }\n      }\n      return event;\n    };\n    eventProcess.id = this.name;\n    addGlobalEventProcessor(eventProcess);\n  }\n}\nInboundFilters.__initStatic();\n\n/** JSDoc */\nfunction _mergeOptions() {\n  let internalOptions = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  let clientOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return {\n    allowUrls: [...(internalOptions.allowUrls || []), ...(clientOptions.allowUrls || [])],\n    denyUrls: [...(internalOptions.denyUrls || []), ...(clientOptions.denyUrls || [])],\n    ignoreErrors: [...(internalOptions.ignoreErrors || []), ...(clientOptions.ignoreErrors || []), ...DEFAULT_IGNORE_ERRORS],\n    ignoreInternal: internalOptions.ignoreInternal !== undefined ? internalOptions.ignoreInternal : true\n  };\n}\n\n/** JSDoc */\nfunction _shouldDropEvent(event, options) {\n  if (options.ignoreInternal && _isSentryError(event)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Event dropped due to being internal Sentry Error.\\nEvent: ${getEventDescription(event)}`);\n    return true;\n  }\n  if (_isIgnoredError(event, options.ignoreErrors)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Event dropped due to being matched by \\`ignoreErrors\\` option.\\nEvent: ${getEventDescription(event)}`);\n    return true;\n  }\n  if (_isDeniedUrl(event, options.denyUrls)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Event dropped due to being matched by \\`denyUrls\\` option.\\nEvent: ${getEventDescription(event)}.\\nUrl: ${_getEventFilterUrl(event)}`);\n    return true;\n  }\n  if (!_isAllowedUrl(event, options.allowUrls)) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.warn(`Event dropped due to not being matched by \\`allowUrls\\` option.\\nEvent: ${getEventDescription(event)}.\\nUrl: ${_getEventFilterUrl(event)}`);\n    return true;\n  }\n  return false;\n}\nfunction _isIgnoredError(event, ignoreErrors) {\n  if (!ignoreErrors || !ignoreErrors.length) {\n    return false;\n  }\n  return _getPossibleEventMessages(event).some(message => stringMatchesSomePattern(message, ignoreErrors));\n}\nfunction _isDeniedUrl(event, denyUrls) {\n  // TODO: Use Glob instead?\n  if (!denyUrls || !denyUrls.length) {\n    return false;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? false : stringMatchesSomePattern(url, denyUrls);\n}\nfunction _isAllowedUrl(event, allowUrls) {\n  // TODO: Use Glob instead?\n  if (!allowUrls || !allowUrls.length) {\n    return true;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? true : stringMatchesSomePattern(url, allowUrls);\n}\nfunction _getPossibleEventMessages(event) {\n  if (event.message) {\n    return [event.message];\n  }\n  if (event.exception) {\n    try {\n      const {\n        type = '',\n        value = ''\n      } = event.exception.values && event.exception.values[0] || {};\n      return [`${value}`, `${type}: ${value}`];\n    } catch (oO) {\n      (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(`Cannot extract message for event ${getEventDescription(event)}`);\n      return [];\n    }\n  }\n  return [];\n}\nfunction _isSentryError(event) {\n  try {\n    // @ts-ignore can't be a sentry error if undefined\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    return event.exception.values[0].type === 'SentryError';\n  } catch (e) {\n    // ignore\n  }\n  return false;\n}\nfunction _getLastValidUrl() {\n  let frames = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  for (let i = frames.length - 1; i >= 0; i--) {\n    const frame = frames[i];\n    if (frame && frame.filename !== '<anonymous>' && frame.filename !== '[native code]') {\n      return frame.filename || null;\n    }\n  }\n  return null;\n}\nfunction _getEventFilterUrl(event) {\n  try {\n    let frames;\n    try {\n      // @ts-ignore we only care about frames if the whole thing here is defined\n      frames = event.exception.values[0].stacktrace.frames;\n    } catch (e) {\n      // ignore\n    }\n    return frames ? _getLastValidUrl(frames) : null;\n  } catch (oO) {\n    (typeof __SENTRY_DEBUG__ === 'undefined' || __SENTRY_DEBUG__) && logger.error(`Cannot extract url for event ${getEventDescription(event)}`);\n    return null;\n  }\n}\nexport { InboundFilters, _mergeOptions, _shouldDropEvent };","map":{"version":3,"sources":["../../../src/integrations/inboundfilters.ts"],"names":[],"mappings":"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","sourcesContent":["import { Event, EventProcessor, Hub, Integration, StackFrame } from '@sentry/types';\nimport { getEventDescription, logger, stringMatchesSomePattern } from '@sentry/utils';\n\n// \"Script error.\" is hard coded into browsers for errors that it can't read.\n// this is the result of a script being pulled in from an external domain and CORS.\nconst DEFAULT_IGNORE_ERRORS = [/^Script error\\.?$/, /^Javascript error: Script error\\.? on line 0$/];\n\n/** Options for the InboundFilters integration */\nexport interface InboundFiltersOptions {\n  allowUrls: Array<string | RegExp>;\n  denyUrls: Array<string | RegExp>;\n  ignoreErrors: Array<string | RegExp>;\n  ignoreInternal: boolean;\n}\n\n/** Inbound filters configurable by the user */\nexport class InboundFilters implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'InboundFilters';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = InboundFilters.id;\n\n  public constructor(private readonly _options: Partial<InboundFiltersOptions> = {}) {}\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(addGlobalEventProcessor: (processor: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    const eventProcess: EventProcessor = (event: Event) => {\n      const hub = getCurrentHub();\n      if (hub) {\n        const self = hub.getIntegration(InboundFilters);\n        if (self) {\n          const client = hub.getClient();\n          const clientOptions = client ? client.getOptions() : {};\n          const options = _mergeOptions(self._options, clientOptions);\n          return _shouldDropEvent(event, options) ? null : event;\n        }\n      }\n      return event;\n    };\n\n    eventProcess.id = this.name;\n    addGlobalEventProcessor(eventProcess);\n  }\n}\n\n/** JSDoc */\nexport function _mergeOptions(\n  internalOptions: Partial<InboundFiltersOptions> = {},\n  clientOptions: Partial<InboundFiltersOptions> = {},\n): Partial<InboundFiltersOptions> {\n  return {\n    allowUrls: [...(internalOptions.allowUrls || []), ...(clientOptions.allowUrls || [])],\n    denyUrls: [...(internalOptions.denyUrls || []), ...(clientOptions.denyUrls || [])],\n    ignoreErrors: [\n      ...(internalOptions.ignoreErrors || []),\n      ...(clientOptions.ignoreErrors || []),\n      ...DEFAULT_IGNORE_ERRORS,\n    ],\n    ignoreInternal: internalOptions.ignoreInternal !== undefined ? internalOptions.ignoreInternal : true,\n  };\n}\n\n/** JSDoc */\nexport function _shouldDropEvent(event: Event, options: Partial<InboundFiltersOptions>): boolean {\n  if (options.ignoreInternal && _isSentryError(event)) {\n    __DEBUG_BUILD__ &&\n      logger.warn(`Event dropped due to being internal Sentry Error.\\nEvent: ${getEventDescription(event)}`);\n    return true;\n  }\n  if (_isIgnoredError(event, options.ignoreErrors)) {\n    __DEBUG_BUILD__ &&\n      logger.warn(\n        `Event dropped due to being matched by \\`ignoreErrors\\` option.\\nEvent: ${getEventDescription(event)}`,\n      );\n    return true;\n  }\n  if (_isDeniedUrl(event, options.denyUrls)) {\n    __DEBUG_BUILD__ &&\n      logger.warn(\n        `Event dropped due to being matched by \\`denyUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  if (!_isAllowedUrl(event, options.allowUrls)) {\n    __DEBUG_BUILD__ &&\n      logger.warn(\n        `Event dropped due to not being matched by \\`allowUrls\\` option.\\nEvent: ${getEventDescription(\n          event,\n        )}.\\nUrl: ${_getEventFilterUrl(event)}`,\n      );\n    return true;\n  }\n  return false;\n}\n\nfunction _isIgnoredError(event: Event, ignoreErrors?: Array<string | RegExp>): boolean {\n  if (!ignoreErrors || !ignoreErrors.length) {\n    return false;\n  }\n\n  return _getPossibleEventMessages(event).some(message => stringMatchesSomePattern(message, ignoreErrors));\n}\n\nfunction _isDeniedUrl(event: Event, denyUrls?: Array<string | RegExp>): boolean {\n  // TODO: Use Glob instead?\n  if (!denyUrls || !denyUrls.length) {\n    return false;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? false : stringMatchesSomePattern(url, denyUrls);\n}\n\nfunction _isAllowedUrl(event: Event, allowUrls?: Array<string | RegExp>): boolean {\n  // TODO: Use Glob instead?\n  if (!allowUrls || !allowUrls.length) {\n    return true;\n  }\n  const url = _getEventFilterUrl(event);\n  return !url ? true : stringMatchesSomePattern(url, allowUrls);\n}\n\nfunction _getPossibleEventMessages(event: Event): string[] {\n  if (event.message) {\n    return [event.message];\n  }\n  if (event.exception) {\n    try {\n      const { type = '', value = '' } = (event.exception.values && event.exception.values[0]) || {};\n      return [`${value}`, `${type}: ${value}`];\n    } catch (oO) {\n      __DEBUG_BUILD__ && logger.error(`Cannot extract message for event ${getEventDescription(event)}`);\n      return [];\n    }\n  }\n  return [];\n}\n\nfunction _isSentryError(event: Event): boolean {\n  try {\n    // @ts-ignore can't be a sentry error if undefined\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    return event.exception.values[0].type === 'SentryError';\n  } catch (e) {\n    // ignore\n  }\n  return false;\n}\n\nfunction _getLastValidUrl(frames: StackFrame[] = []): string | null {\n  for (let i = frames.length - 1; i >= 0; i--) {\n    const frame = frames[i];\n\n    if (frame && frame.filename !== '<anonymous>' && frame.filename !== '[native code]') {\n      return frame.filename || null;\n    }\n  }\n\n  return null;\n}\n\nfunction _getEventFilterUrl(event: Event): string | null {\n  try {\n    let frames;\n    try {\n      // @ts-ignore we only care about frames if the whole thing here is defined\n      frames = event.exception.values[0].stacktrace.frames;\n    } catch (e) {\n      // ignore\n    }\n    return frames ? _getLastValidUrl(frames) : null;\n  } catch (oO) {\n    __DEBUG_BUILD__ && logger.error(`Cannot extract url for event ${getEventDescription(event)}`);\n    return null;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}