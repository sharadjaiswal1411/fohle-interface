{"ast":null,"code":"import _defineProperty from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";var _RETRY_OPTIONS_BY_CHA;import{useWeb3React}from'@web3-react/core';import{SupportedChainId}from'constants/chains';import useBlockNumber from'lib/hooks/useBlockNumber';import{useCallback,useEffect}from'react';import{retry,RetryableError}from'utils/retry';export function shouldCheck(lastBlockNumber,tx){if(tx.receipt)return false;if(!tx.lastCheckedBlockNumber)return true;var blocksSinceCheck=lastBlockNumber-tx.lastCheckedBlockNumber;if(blocksSinceCheck<1)return false;var minutesPending=(new Date().getTime()-tx.addedTime)/60000;if(minutesPending>60){// every 10 blocks if pending longer than an hour\nreturn blocksSinceCheck>9;}else if(minutesPending>5){// every 3 blocks if pending longer than 5 minutes\nreturn blocksSinceCheck>2;}else{// otherwise every block\nreturn true;}}var RETRY_OPTIONS_BY_CHAIN_ID=(_RETRY_OPTIONS_BY_CHA={},_defineProperty(_RETRY_OPTIONS_BY_CHA,SupportedChainId.ARBITRUM_ONE,{n:10,minWait:250,maxWait:1000}),_defineProperty(_RETRY_OPTIONS_BY_CHA,SupportedChainId.ARBITRUM_RINKEBY,{n:10,minWait:250,maxWait:1000}),_defineProperty(_RETRY_OPTIONS_BY_CHA,SupportedChainId.OPTIMISM_GOERLI,{n:10,minWait:250,maxWait:1000}),_defineProperty(_RETRY_OPTIONS_BY_CHA,SupportedChainId.OPTIMISM,{n:10,minWait:250,maxWait:1000}),_RETRY_OPTIONS_BY_CHA);var DEFAULT_RETRY_OPTIONS={n:1,minWait:0,maxWait:0};export default function Updater(_ref){var pendingTransactions=_ref.pendingTransactions,onCheck=_ref.onCheck,onReceipt=_ref.onReceipt;var _useWeb3React=useWeb3React(),chainId=_useWeb3React.chainId,provider=_useWeb3React.provider;var lastBlockNumber=useBlockNumber();var getReceipt=useCallback(function(hash){var _RETRY_OPTIONS_BY_CHA2;if(!provider||!chainId)throw new Error('No provider or chainId');var retryOptions=(_RETRY_OPTIONS_BY_CHA2=RETRY_OPTIONS_BY_CHAIN_ID[chainId])!==null&&_RETRY_OPTIONS_BY_CHA2!==void 0?_RETRY_OPTIONS_BY_CHA2:DEFAULT_RETRY_OPTIONS;return retry(function(){return provider.getTransactionReceipt(hash).then(function(receipt){if(receipt===null){console.debug(\"Retrying tranasaction receipt for \".concat(hash));throw new RetryableError();}return receipt;});},retryOptions);},[chainId,provider]);useEffect(function(){if(!chainId||!provider||!lastBlockNumber)return;var cancels=Object.keys(pendingTransactions).filter(function(hash){return shouldCheck(lastBlockNumber,pendingTransactions[hash]);}).map(function(hash){var _getReceipt=getReceipt(hash),promise=_getReceipt.promise,cancel=_getReceipt.cancel;promise.then(function(receipt){if(receipt){onReceipt({chainId:chainId,hash:hash,receipt:receipt});}else{onCheck({chainId:chainId,hash:hash,blockNumber:lastBlockNumber});}}).catch(function(error){if(!error.isCancelledError){console.warn(\"Failed to get transaction receipt for \".concat(hash),error);}});return cancel;});return function(){cancels.forEach(function(cancel){return cancel();});};},[chainId,provider,lastBlockNumber,getReceipt,onReceipt,onCheck,pendingTransactions]);return null;}","map":{"version":3,"names":["useWeb3React","SupportedChainId","useBlockNumber","useCallback","useEffect","retry","RetryableError","shouldCheck","lastBlockNumber","tx","receipt","lastCheckedBlockNumber","blocksSinceCheck","minutesPending","Date","getTime","addedTime","RETRY_OPTIONS_BY_CHAIN_ID","ARBITRUM_ONE","n","minWait","maxWait","ARBITRUM_RINKEBY","OPTIMISM_GOERLI","OPTIMISM","DEFAULT_RETRY_OPTIONS","Updater","pendingTransactions","onCheck","onReceipt","chainId","provider","getReceipt","hash","Error","retryOptions","getTransactionReceipt","then","console","debug","cancels","Object","keys","filter","map","promise","cancel","blockNumber","catch","error","isCancelledError","warn","forEach"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/lib/hooks/transactions/updater.tsx"],"sourcesContent":["import { TransactionReceipt } from '@ethersproject/abstract-provider'\nimport { useWeb3React } from '@web3-react/core'\nimport { SupportedChainId } from 'constants/chains'\nimport useBlockNumber from 'lib/hooks/useBlockNumber'\nimport ms from 'ms.macro'\nimport { useCallback, useEffect } from 'react'\nimport { retry, RetryableError, RetryOptions } from 'utils/retry'\n\ninterface Transaction {\n  addedTime: number\n  receipt?: unknown\n  lastCheckedBlockNumber?: number\n}\n\nexport function shouldCheck(lastBlockNumber: number, tx: Transaction): boolean {\n  if (tx.receipt) return false\n  if (!tx.lastCheckedBlockNumber) return true\n  const blocksSinceCheck = lastBlockNumber - tx.lastCheckedBlockNumber\n  if (blocksSinceCheck < 1) return false\n  const minutesPending = (new Date().getTime() - tx.addedTime) / ms`1m`\n  if (minutesPending > 60) {\n    // every 10 blocks if pending longer than an hour\n    return blocksSinceCheck > 9\n  } else if (minutesPending > 5) {\n    // every 3 blocks if pending longer than 5 minutes\n    return blocksSinceCheck > 2\n  } else {\n    // otherwise every block\n    return true\n  }\n}\n\nconst RETRY_OPTIONS_BY_CHAIN_ID: { [chainId: number]: RetryOptions } = {\n  [SupportedChainId.ARBITRUM_ONE]: { n: 10, minWait: 250, maxWait: 1000 },\n  [SupportedChainId.ARBITRUM_RINKEBY]: { n: 10, minWait: 250, maxWait: 1000 },\n  [SupportedChainId.OPTIMISM_GOERLI]: { n: 10, minWait: 250, maxWait: 1000 },\n  [SupportedChainId.OPTIMISM]: { n: 10, minWait: 250, maxWait: 1000 },\n}\nconst DEFAULT_RETRY_OPTIONS: RetryOptions = { n: 1, minWait: 0, maxWait: 0 }\n\ninterface UpdaterProps {\n  pendingTransactions: { [hash: string]: Transaction }\n  onCheck: (tx: { chainId: number; hash: string; blockNumber: number }) => void\n  onReceipt: (tx: { chainId: number; hash: string; receipt: TransactionReceipt }) => void\n}\n\nexport default function Updater({ pendingTransactions, onCheck, onReceipt }: UpdaterProps): null {\n  const { chainId, provider } = useWeb3React()\n\n  const lastBlockNumber = useBlockNumber()\n\n  const getReceipt = useCallback(\n    (hash: string) => {\n      if (!provider || !chainId) throw new Error('No provider or chainId')\n      const retryOptions = RETRY_OPTIONS_BY_CHAIN_ID[chainId] ?? DEFAULT_RETRY_OPTIONS\n      return retry(\n        () =>\n          provider.getTransactionReceipt(hash).then((receipt) => {\n            if (receipt === null) {\n              console.debug(`Retrying tranasaction receipt for ${hash}`)\n              throw new RetryableError()\n            }\n            return receipt\n          }),\n        retryOptions\n      )\n    },\n    [chainId, provider]\n  )\n\n  useEffect(() => {\n    if (!chainId || !provider || !lastBlockNumber) return\n\n    const cancels = Object.keys(pendingTransactions)\n      .filter((hash) => shouldCheck(lastBlockNumber, pendingTransactions[hash]))\n      .map((hash) => {\n        const { promise, cancel } = getReceipt(hash)\n        promise\n          .then((receipt) => {\n            if (receipt) {\n              onReceipt({ chainId, hash, receipt })\n            } else {\n              onCheck({ chainId, hash, blockNumber: lastBlockNumber })\n            }\n          })\n          .catch((error) => {\n            if (!error.isCancelledError) {\n              console.warn(`Failed to get transaction receipt for ${hash}`, error)\n            }\n          })\n        return cancel\n      })\n\n    return () => {\n      cancels.forEach((cancel) => cancel())\n    }\n  }, [chainId, provider, lastBlockNumber, getReceipt, onReceipt, onCheck, pendingTransactions])\n\n  return null\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}