{"ast":null,"code":"import { __assign, __awaiter, __extends, __generator, __values } from \"tslib\";\nimport { TransportType } from '@amplitude/analytics-types';\nimport { Config, MemoryStorage, UUID } from '@amplitude/analytics-core';\nimport { CookieStorage, getCookieName, getQueryParams, SessionManager, FetchTransport } from '@amplitude/analytics-client-common';\nimport { LocalStorage } from './storage/local-storage';\nimport { XHRTransport } from './transports/xhr';\nimport { SendBeaconTransport } from './transports/send-beacon';\nexport var getDefaultConfig = function getDefaultConfig() {\n  var cookieStorage = new MemoryStorage();\n  var trackingOptions = {\n    deviceManufacturer: true,\n    deviceModel: true,\n    ipAddress: true,\n    language: true,\n    osName: true,\n    osVersion: true,\n    platform: true\n  };\n  return {\n    cookieExpiration: 365,\n    cookieSameSite: 'Lax',\n    cookieSecure: false,\n    cookieStorage: cookieStorage,\n    disableCookies: false,\n    domain: '',\n    sessionManager: new SessionManager(cookieStorage, ''),\n    sessionTimeout: 30 * 60 * 1000,\n    storageProvider: new MemoryStorage(),\n    trackingOptions: trackingOptions,\n    transportProvider: new FetchTransport()\n  };\n};\nvar BrowserConfig = /** @class */function (_super) {\n  __extends(BrowserConfig, _super);\n  function BrowserConfig(apiKey, userId, options) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m;\n    var _this = this;\n    var defaultConfig = getDefaultConfig();\n    _this = _super.call(this, __assign(__assign({\n      flushIntervalMillis: 1000,\n      flushMaxRetries: 5,\n      flushQueueSize: 30\n    }, options), {\n      apiKey: apiKey,\n      storageProvider: (_a = options === null || options === void 0 ? void 0 : options.storageProvider) !== null && _a !== void 0 ? _a : defaultConfig.storageProvider,\n      transportProvider: (_b = options === null || options === void 0 ? void 0 : options.transportProvider) !== null && _b !== void 0 ? _b : defaultConfig.transportProvider\n    })) || this;\n    _this.cookieStorage = (_c = options === null || options === void 0 ? void 0 : options.cookieStorage) !== null && _c !== void 0 ? _c : defaultConfig.cookieStorage;\n    _this.sessionManager = (_d = options === null || options === void 0 ? void 0 : options.sessionManager) !== null && _d !== void 0 ? _d : defaultConfig.sessionManager;\n    _this.sessionTimeout = (_e = options === null || options === void 0 ? void 0 : options.sessionTimeout) !== null && _e !== void 0 ? _e : defaultConfig.sessionTimeout;\n    _this.appVersion = options === null || options === void 0 ? void 0 : options.appVersion;\n    _this.attribution = options === null || options === void 0 ? void 0 : options.attribution;\n    _this.cookieExpiration = (_f = options === null || options === void 0 ? void 0 : options.cookieExpiration) !== null && _f !== void 0 ? _f : defaultConfig.cookieExpiration;\n    _this.cookieSameSite = (_g = options === null || options === void 0 ? void 0 : options.cookieSameSite) !== null && _g !== void 0 ? _g : defaultConfig.cookieSameSite;\n    _this.cookieSecure = (_h = options === null || options === void 0 ? void 0 : options.cookieSecure) !== null && _h !== void 0 ? _h : defaultConfig.cookieSecure;\n    _this.deviceId = options === null || options === void 0 ? void 0 : options.deviceId;\n    _this.disableCookies = (_j = options === null || options === void 0 ? void 0 : options.disableCookies) !== null && _j !== void 0 ? _j : defaultConfig.disableCookies;\n    _this.domain = (_k = options === null || options === void 0 ? void 0 : options.domain) !== null && _k !== void 0 ? _k : defaultConfig.domain;\n    _this.lastEventTime = (_l = _this.lastEventTime) !== null && _l !== void 0 ? _l : options === null || options === void 0 ? void 0 : options.lastEventTime;\n    _this.optOut = Boolean(options === null || options === void 0 ? void 0 : options.optOut);\n    _this.partnerId = options === null || options === void 0 ? void 0 : options.partnerId;\n    _this.sessionId = options === null || options === void 0 ? void 0 : options.sessionId;\n    _this.trackingOptions = (_m = options === null || options === void 0 ? void 0 : options.trackingOptions) !== null && _m !== void 0 ? _m : defaultConfig.trackingOptions;\n    _this.userId = userId;\n    return _this;\n  }\n  Object.defineProperty(BrowserConfig.prototype, \"deviceId\", {\n    get: function get() {\n      return this.sessionManager.getDeviceId();\n    },\n    set: function set(deviceId) {\n      this.sessionManager.setDeviceId(deviceId);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BrowserConfig.prototype, \"userId\", {\n    get: function get() {\n      return this.sessionManager.getUserId();\n    },\n    set: function set(userId) {\n      this.sessionManager.setUserId(userId);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BrowserConfig.prototype, \"sessionId\", {\n    get: function get() {\n      return this.sessionManager.getSessionId();\n    },\n    set: function set(sessionId) {\n      this.sessionManager.setSessionId(sessionId);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BrowserConfig.prototype, \"optOut\", {\n    get: function get() {\n      return this.sessionManager.getOptOut();\n    },\n    set: function set(optOut) {\n      var _a;\n      (_a = this.sessionManager) === null || _a === void 0 ? void 0 : _a.setOptOut(Boolean(optOut));\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(BrowserConfig.prototype, \"lastEventTime\", {\n    get: function get() {\n      return this.sessionManager.getLastEventTime();\n    },\n    set: function set(lastEventTime) {\n      this.sessionManager.setLastEventTime(lastEventTime);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return BrowserConfig;\n}(Config);\nexport { BrowserConfig };\nexport var useBrowserConfig = function useBrowserConfig(apiKey, userId, options) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var defaultConfig, domain, _a, cookieStorage, cookieName, cookies, queryParams, sessionManager, _b, _c, _d;\n    var _e;\n    var _f, _g, _h, _j, _k;\n    return __generator(this, function (_l) {\n      switch (_l.label) {\n        case 0:\n          defaultConfig = getDefaultConfig();\n          if (!((_f = options === null || options === void 0 ? void 0 : options.domain) !== null && _f !== void 0)) return [3 /*break*/, 1];\n          _a = _f;\n          return [3 /*break*/, 3];\n        case 1:\n          return [4 /*yield*/, getTopLevelDomain()];\n        case 2:\n          _a = _l.sent();\n          _l.label = 3;\n        case 3:\n          domain = _a;\n          return [4 /*yield*/, createCookieStorage(__assign(__assign({}, options), {\n            domain: domain\n          }))];\n        case 4:\n          cookieStorage = _l.sent();\n          cookieName = getCookieName(apiKey);\n          return [4 /*yield*/, cookieStorage.get(cookieName)];\n        case 5:\n          cookies = _l.sent();\n          queryParams = getQueryParams();\n          return [4 /*yield*/, new SessionManager(cookieStorage, apiKey).load()];\n        case 6:\n          sessionManager = _l.sent();\n          _b = BrowserConfig.bind;\n          _c = [void 0, apiKey, userId !== null && userId !== void 0 ? userId : cookies === null || cookies === void 0 ? void 0 : cookies.userId];\n          _d = [__assign({}, options)];\n          _e = {\n            cookieStorage: cookieStorage,\n            sessionManager: sessionManager,\n            deviceId: createDeviceId(cookies === null || cookies === void 0 ? void 0 : cookies.deviceId, options === null || options === void 0 ? void 0 : options.deviceId, queryParams.deviceId),\n            domain: domain,\n            optOut: (_g = options === null || options === void 0 ? void 0 : options.optOut) !== null && _g !== void 0 ? _g : Boolean(cookies === null || cookies === void 0 ? void 0 : cookies.optOut)\n          };\n          return [4 /*yield*/, cookieStorage.get(cookieName)];\n        case 7:\n          _e.sessionId = (_j = (_h = _l.sent()) === null || _h === void 0 ? void 0 : _h.sessionId) !== null && _j !== void 0 ? _j : options === null || options === void 0 ? void 0 : options.sessionId;\n          return [4 /*yield*/, createEventsStorage(options)];\n        case 8:\n          return [2 /*return*/, new (_b.apply(BrowserConfig, _c.concat([__assign.apply(void 0, _d.concat([(_e.storageProvider = _l.sent(), _e.trackingOptions = __assign(__assign({}, defaultConfig.trackingOptions), options === null || options === void 0 ? void 0 : options.trackingOptions), _e.transportProvider = (_k = options === null || options === void 0 ? void 0 : options.transportProvider) !== null && _k !== void 0 ? _k : createTransport(options === null || options === void 0 ? void 0 : options.transport), _e)]))])))()];\n      }\n    });\n  });\n};\nexport var createCookieStorage = function createCookieStorage(overrides, baseConfig) {\n  if (baseConfig === void 0) {\n    baseConfig = getDefaultConfig();\n  }\n  return __awaiter(void 0, void 0, void 0, function () {\n    var options, cookieStorage, _a;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          options = __assign(__assign({}, baseConfig), overrides);\n          cookieStorage = overrides === null || overrides === void 0 ? void 0 : overrides.cookieStorage;\n          _a = !cookieStorage;\n          if (_a) return [3 /*break*/, 2];\n          return [4 /*yield*/, cookieStorage.isEnabled()];\n        case 1:\n          _a = !_b.sent();\n          _b.label = 2;\n        case 2:\n          if (_a) {\n            return [2 /*return*/, createFlexibleStorage(options)];\n          }\n          return [2 /*return*/, cookieStorage];\n      }\n    });\n  });\n};\nexport var createFlexibleStorage = function createFlexibleStorage(options) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var storage, _a;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          storage = new CookieStorage({\n            domain: options.domain,\n            expirationDays: options.cookieExpiration,\n            sameSite: options.cookieSameSite,\n            secure: options.cookieSecure\n          });\n          _a = options.disableCookies;\n          if (_a) return [3 /*break*/, 2];\n          return [4 /*yield*/, storage.isEnabled()];\n        case 1:\n          _a = !_b.sent();\n          _b.label = 2;\n        case 2:\n          if (!_a) return [3 /*break*/, 4];\n          storage = new LocalStorage();\n          return [4 /*yield*/, storage.isEnabled()];\n        case 3:\n          if (!_b.sent()) {\n            storage = new MemoryStorage();\n          }\n          _b.label = 4;\n        case 4:\n          return [2 /*return*/, storage];\n      }\n    });\n  });\n};\nexport var createEventsStorage = function createEventsStorage(overrides) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var hasStorageProviderProperty, _a, _b, storage, _c, e_1_1;\n    var e_1, _d;\n    return __generator(this, function (_e) {\n      switch (_e.label) {\n        case 0:\n          hasStorageProviderProperty = overrides && Object.prototype.hasOwnProperty.call(overrides, 'storageProvider');\n          if (!(!hasStorageProviderProperty || overrides.storageProvider)) return [3 /*break*/, 9];\n          _e.label = 1;\n        case 1:\n          _e.trys.push([1, 7, 8, 9]);\n          _a = __values([overrides === null || overrides === void 0 ? void 0 : overrides.storageProvider, new LocalStorage()]), _b = _a.next();\n          _e.label = 2;\n        case 2:\n          if (!!_b.done) return [3 /*break*/, 6];\n          storage = _b.value;\n          _c = storage;\n          if (!_c) return [3 /*break*/, 4];\n          return [4 /*yield*/, storage.isEnabled()];\n        case 3:\n          _c = _e.sent();\n          _e.label = 4;\n        case 4:\n          if (_c) {\n            return [2 /*return*/, storage];\n          }\n          _e.label = 5;\n        case 5:\n          _b = _a.next();\n          return [3 /*break*/, 2];\n        case 6:\n          return [3 /*break*/, 9];\n        case 7:\n          e_1_1 = _e.sent();\n          e_1 = {\n            error: e_1_1\n          };\n          return [3 /*break*/, 9];\n        case 8:\n          try {\n            if (_b && !_b.done && (_d = _a.return)) _d.call(_a);\n          } finally {\n            if (e_1) throw e_1.error;\n          }\n          return [7 /*endfinally*/];\n        case 9:\n          return [2 /*return*/, undefined];\n      }\n    });\n  });\n};\nexport var createDeviceId = function createDeviceId(idFromCookies, idFromOptions, idFromQueryParams) {\n  return idFromOptions || idFromQueryParams || idFromCookies || UUID();\n};\nexport var createTransport = function createTransport(transport) {\n  if (transport === TransportType.XHR) {\n    return new XHRTransport();\n  }\n  if (transport === TransportType.SendBeacon) {\n    return new SendBeaconTransport();\n  }\n  return getDefaultConfig().transportProvider;\n};\nexport var getTopLevelDomain = function getTopLevelDomain(url) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var host, parts, levels, storageKey, i, i, domain, options, storage, value;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, new CookieStorage().isEnabled()];\n        case 1:\n          if (!_a.sent() || !url && typeof location === 'undefined') {\n            return [2 /*return*/, ''];\n          }\n          host = url !== null && url !== void 0 ? url : location.hostname;\n          parts = host.split('.');\n          levels = [];\n          storageKey = 'AMP_TLDTEST';\n          for (i = parts.length - 2; i >= 0; --i) {\n            levels.push(parts.slice(i).join('.'));\n          }\n          i = 0;\n          _a.label = 2;\n        case 2:\n          if (!(i < levels.length)) return [3 /*break*/, 7];\n          domain = levels[i];\n          options = {\n            domain: '.' + domain\n          };\n          storage = new CookieStorage(options);\n          return [4 /*yield*/, storage.set(storageKey, 1)];\n        case 3:\n          _a.sent();\n          return [4 /*yield*/, storage.get(storageKey)];\n        case 4:\n          value = _a.sent();\n          if (!value) return [3 /*break*/, 6];\n          return [4 /*yield*/, storage.remove(storageKey)];\n        case 5:\n          _a.sent();\n          return [2 /*return*/, '.' + domain];\n        case 6:\n          i++;\n          return [3 /*break*/, 2];\n        case 7:\n          return [2 /*return*/, ''];\n      }\n    });\n  });\n};","map":{"version":3,"sources":["../../src/config.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  AttributionOptions,\n  Event,\n  BrowserOptions,\n  BrowserConfig as IBrowserConfig,\n  Storage,\n  TrackingOptions,\n  TransportType,\n  UserSession,\n  SessionManager as ISessionManager,\n} from '@amplitude/analytics-types';\nimport { Config, MemoryStorage, UUID } from '@amplitude/analytics-core';\nimport {\n  CookieStorage,\n  getCookieName,\n  getQueryParams,\n  SessionManager,\n  FetchTransport,\n} from '@amplitude/analytics-client-common';\n\nimport { LocalStorage } from './storage/local-storage';\nimport { XHRTransport } from './transports/xhr';\nimport { SendBeaconTransport } from './transports/send-beacon';\n\nexport const getDefaultConfig = () => {\n  const cookieStorage = new MemoryStorage<UserSession>();\n  const trackingOptions: Required<TrackingOptions> = {\n    deviceManufacturer: true,\n    deviceModel: true,\n    ipAddress: true,\n    language: true,\n    osName: true,\n    osVersion: true,\n    platform: true,\n  };\n  return {\n    cookieExpiration: 365,\n    cookieSameSite: 'Lax',\n    cookieSecure: false,\n    cookieStorage,\n    disableCookies: false,\n    domain: '',\n    sessionManager: new SessionManager(cookieStorage, ''),\n    sessionTimeout: 30 * 60 * 1000,\n    storageProvider: new MemoryStorage<Event[]>(),\n    trackingOptions,\n    transportProvider: new FetchTransport(),\n  };\n};\n\nexport class BrowserConfig extends Config implements IBrowserConfig {\n  appVersion?: string;\n  attribution?: AttributionOptions;\n  cookieExpiration: number;\n  cookieSameSite: string;\n  cookieSecure: boolean;\n  cookieStorage: Storage<UserSession>;\n  disableCookies: boolean;\n  domain: string;\n  partnerId?: string;\n  sessionTimeout: number;\n  trackingOptions: TrackingOptions;\n  sessionManager: ISessionManager;\n\n  constructor(apiKey: string, userId?: string, options?: BrowserOptions) {\n    const defaultConfig = getDefaultConfig();\n    super({\n      flushIntervalMillis: 1000,\n      flushMaxRetries: 5,\n      flushQueueSize: 30,\n      ...options,\n      apiKey,\n      storageProvider: options?.storageProvider ?? defaultConfig.storageProvider,\n      transportProvider: options?.transportProvider ?? defaultConfig.transportProvider,\n    });\n    this.cookieStorage = options?.cookieStorage ?? defaultConfig.cookieStorage;\n    this.sessionManager = options?.sessionManager ?? defaultConfig.sessionManager;\n    this.sessionTimeout = options?.sessionTimeout ?? defaultConfig.sessionTimeout;\n\n    this.appVersion = options?.appVersion;\n    this.attribution = options?.attribution;\n    this.cookieExpiration = options?.cookieExpiration ?? defaultConfig.cookieExpiration;\n    this.cookieSameSite = options?.cookieSameSite ?? defaultConfig.cookieSameSite;\n    this.cookieSecure = options?.cookieSecure ?? defaultConfig.cookieSecure;\n    this.deviceId = options?.deviceId;\n    this.disableCookies = options?.disableCookies ?? defaultConfig.disableCookies;\n    this.domain = options?.domain ?? defaultConfig.domain;\n    this.lastEventTime = this.lastEventTime ?? options?.lastEventTime;\n    this.optOut = Boolean(options?.optOut);\n    this.partnerId = options?.partnerId;\n    this.sessionId = options?.sessionId;\n    this.trackingOptions = options?.trackingOptions ?? defaultConfig.trackingOptions;\n    this.userId = userId;\n  }\n\n  get deviceId() {\n    return this.sessionManager.getDeviceId();\n  }\n\n  set deviceId(deviceId: string | undefined) {\n    this.sessionManager.setDeviceId(deviceId);\n  }\n\n  get userId() {\n    return this.sessionManager.getUserId();\n  }\n\n  set userId(userId: string | undefined) {\n    this.sessionManager.setUserId(userId);\n  }\n\n  get sessionId() {\n    return this.sessionManager.getSessionId();\n  }\n\n  set sessionId(sessionId: number | undefined) {\n    this.sessionManager.setSessionId(sessionId);\n  }\n\n  get optOut() {\n    return this.sessionManager.getOptOut();\n  }\n\n  set optOut(optOut: boolean) {\n    this.sessionManager?.setOptOut(Boolean(optOut));\n  }\n\n  get lastEventTime() {\n    return this.sessionManager.getLastEventTime();\n  }\n\n  set lastEventTime(lastEventTime: number | undefined) {\n    this.sessionManager.setLastEventTime(lastEventTime);\n  }\n}\n\nexport const useBrowserConfig = async (\n  apiKey: string,\n  userId?: string,\n  options?: BrowserOptions,\n): Promise<IBrowserConfig> => {\n  const defaultConfig = getDefaultConfig();\n  const domain = options?.domain ?? (await getTopLevelDomain());\n  const cookieStorage = await createCookieStorage({ ...options, domain });\n  const cookieName = getCookieName(apiKey);\n  const cookies = await cookieStorage.get(cookieName);\n  const queryParams = getQueryParams();\n  const sessionManager = await new SessionManager(cookieStorage, apiKey).load();\n\n  return new BrowserConfig(apiKey, userId ?? cookies?.userId, {\n    ...options,\n    cookieStorage,\n    sessionManager,\n    deviceId: createDeviceId(cookies?.deviceId, options?.deviceId, queryParams.deviceId),\n    domain,\n    optOut: options?.optOut ?? Boolean(cookies?.optOut),\n    sessionId: (await cookieStorage.get(cookieName))?.sessionId ?? options?.sessionId,\n    storageProvider: await createEventsStorage(options),\n    trackingOptions: { ...defaultConfig.trackingOptions, ...options?.trackingOptions },\n    transportProvider: options?.transportProvider ?? createTransport(options?.transport),\n  });\n};\n\nexport const createCookieStorage = async (\n  overrides?: BrowserOptions,\n  baseConfig = getDefaultConfig(),\n): Promise<Storage<UserSession>> => {\n  const options = { ...baseConfig, ...overrides };\n  const cookieStorage = overrides?.cookieStorage;\n  if (!cookieStorage || !(await cookieStorage.isEnabled())) {\n    return createFlexibleStorage<UserSession>(options);\n  }\n  return cookieStorage;\n};\n\nexport const createFlexibleStorage = async <T>(options: BrowserOptions): Promise<Storage<T>> => {\n  let storage: Storage<T> = new CookieStorage({\n    domain: options.domain,\n    expirationDays: options.cookieExpiration,\n    sameSite: options.cookieSameSite,\n    secure: options.cookieSecure,\n  });\n  if (options.disableCookies || !(await storage.isEnabled())) {\n    storage = new LocalStorage();\n    if (!(await storage.isEnabled())) {\n      storage = new MemoryStorage();\n    }\n  }\n  return storage;\n};\n\nexport const createEventsStorage = async (overrides?: BrowserOptions): Promise<Storage<Event[]> | undefined> => {\n  const hasStorageProviderProperty = overrides && Object.prototype.hasOwnProperty.call(overrides, 'storageProvider');\n  // If storageProperty is explicitly undefined `{ storageProperty: undefined }`\n  // then storageProvider is undefined\n  // If storageProvider is implicitly undefined `{ }`\n  // then storageProvider is LocalStorage\n  // Otherwise storageProvider is overriden\n  if (!hasStorageProviderProperty || overrides.storageProvider) {\n    for (const storage of [overrides?.storageProvider, new LocalStorage<Event[]>()]) {\n      if (storage && (await storage.isEnabled())) {\n        return storage;\n      }\n    }\n  }\n  return undefined;\n};\n\nexport const createDeviceId = (idFromCookies?: string, idFromOptions?: string, idFromQueryParams?: string) => {\n  return idFromOptions || idFromQueryParams || idFromCookies || UUID();\n};\n\nexport const createTransport = (transport?: TransportType) => {\n  if (transport === TransportType.XHR) {\n    return new XHRTransport();\n  }\n  if (transport === TransportType.SendBeacon) {\n    return new SendBeaconTransport();\n  }\n  return getDefaultConfig().transportProvider;\n};\n\nexport const getTopLevelDomain = async (url?: string) => {\n  if (!(await new CookieStorage<string>().isEnabled()) || (!url && typeof location === 'undefined')) {\n    return '';\n  }\n\n  const host = url ?? location.hostname;\n  const parts = host.split('.');\n  const levels = [];\n  const storageKey = 'AMP_TLDTEST';\n\n  for (let i = parts.length - 2; i >= 0; --i) {\n    levels.push(parts.slice(i).join('.'));\n  }\n  for (let i = 0; i < levels.length; i++) {\n    const domain = levels[i];\n    const options = { domain: '.' + domain };\n    const storage = new CookieStorage<number>(options);\n    await storage.set(storageKey, 1);\n    const value = await storage.get(storageKey);\n    if (value) {\n      await storage.remove(storageKey);\n      return '.' + domain;\n    }\n  }\n\n  return '';\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}