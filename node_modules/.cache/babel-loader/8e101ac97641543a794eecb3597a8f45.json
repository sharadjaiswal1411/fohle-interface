{"ast":null,"code":"import _regeneratorRuntime from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{AllowanceProvider,AllowanceTransfer,MaxAllowanceTransferAmount,PERMIT2_ADDRESS}from'@uniswap/permit2-sdk';import{useWeb3React}from'@web3-react/core';import useBlockNumber from'lib/hooks/useBlockNumber';import{useCallback,useEffect,useMemo,useState}from'react';var PERMIT_EXPIRATION=2592000000;var PERMIT_SIG_EXPIRATION=1800000;function toDeadline(expiration){return Math.floor((Date.now()+expiration)/1000);}export function usePermitAllowance(token,spender){var _useWeb3React=useWeb3React(),account=_useWeb3React.account,provider=_useWeb3React.provider;var allowanceProvider=useMemo(function(){return provider&&new AllowanceProvider(provider,PERMIT2_ADDRESS);},[provider]);var _useState=useState(),_useState2=_slicedToArray(_useState,2),allowanceData=_useState2[0],setAllowanceData=_useState2[1];// If there is no allowanceData, recheck every block so a submitted allowance is immediately observed.\nvar blockNumber=useBlockNumber();var shouldUpdate=allowanceData?false:blockNumber;useEffect(function(){if(!account||!token||!spender)return;allowanceProvider===null||allowanceProvider===void 0?void 0:allowanceProvider.getAllowanceData(token.address,account,spender).then(function(data){if(stale)return;setAllowanceData(data);}).catch(function(e){console.warn(\"Failed to fetch allowance data: \".concat(e));});var stale=false;return function(){stale=true;};},[account,allowanceProvider,shouldUpdate,spender,token]);return allowanceData;}export function useUpdatePermitAllowance(token,spender,nonce,onPermitSignature){var _useWeb3React2=useWeb3React(),account=_useWeb3React2.account,chainId=_useWeb3React2.chainId,provider=_useWeb3React2.provider;return useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var permit,_AllowanceTransfer$ge,domain,types,values,_signature,_token$symbol,symbol;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(chainId){_context.next=3;break;}throw new Error('missing chainId');case 3:if(provider){_context.next=5;break;}throw new Error('missing provider');case 5:if(token){_context.next=7;break;}throw new Error('missing token');case 7:if(spender){_context.next=9;break;}throw new Error('missing spender');case 9:if(!(nonce===undefined)){_context.next=11;break;}throw new Error('missing nonce');case 11:permit={details:{token:token.address,amount:MaxAllowanceTransferAmount,expiration:toDeadline(PERMIT_EXPIRATION),nonce:nonce},spender:spender,sigDeadline:toDeadline(PERMIT_SIG_EXPIRATION)};_AllowanceTransfer$ge=AllowanceTransfer.getPermitData(permit,PERMIT2_ADDRESS,chainId),domain=_AllowanceTransfer$ge.domain,types=_AllowanceTransfer$ge.types,values=_AllowanceTransfer$ge.values;_context.next=15;return provider.getSigner(account)._signTypedData(domain,types,values);case 15:_signature=_context.sent;onPermitSignature===null||onPermitSignature===void 0?void 0:onPermitSignature(_objectSpread(_objectSpread({},permit),{},{signature:_signature}));return _context.abrupt(\"return\");case 20:_context.prev=20;_context.t0=_context[\"catch\"](0);symbol=(_token$symbol=token===null||token===void 0?void 0:token.symbol)!==null&&_token$symbol!==void 0?_token$symbol:'Token';throw new Error(\"\".concat(symbol,\" permit failed: \").concat(_context.t0 instanceof Error?_context.t0.message:_context.t0));case 24:case\"end\":return _context.stop();}}},_callee,null,[[0,20]]);})),[account,chainId,nonce,onPermitSignature,provider,spender,token]);}","map":{"version":3,"names":["AllowanceProvider","AllowanceTransfer","MaxAllowanceTransferAmount","PERMIT2_ADDRESS","useWeb3React","useBlockNumber","useCallback","useEffect","useMemo","useState","PERMIT_EXPIRATION","PERMIT_SIG_EXPIRATION","toDeadline","expiration","Math","floor","Date","now","usePermitAllowance","token","spender","account","provider","allowanceProvider","allowanceData","setAllowanceData","blockNumber","shouldUpdate","getAllowanceData","address","then","data","stale","catch","e","console","warn","useUpdatePermitAllowance","nonce","onPermitSignature","chainId","Error","undefined","permit","details","amount","sigDeadline","getPermitData","domain","types","values","getSigner","_signTypedData","signature","symbol","message"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/hooks/usePermitAllowance.ts"],"sourcesContent":["import {\n  AllowanceData,\n  AllowanceProvider,\n  AllowanceTransfer,\n  MaxAllowanceTransferAmount,\n  PERMIT2_ADDRESS,\n  PermitSingle,\n} from '@uniswap/permit2-sdk'\nimport { Token } from '@uniswap/sdk-core'\nimport { useWeb3React } from '@web3-react/core'\nimport useBlockNumber from 'lib/hooks/useBlockNumber'\nimport ms from 'ms.macro'\nimport { useCallback, useEffect, useMemo, useState } from 'react'\n\nconst PERMIT_EXPIRATION = ms`30d`\nconst PERMIT_SIG_EXPIRATION = ms`30m`\n\nfunction toDeadline(expiration: number): number {\n  return Math.floor((Date.now() + expiration) / 1000)\n}\n\nexport function usePermitAllowance(token?: Token, spender?: string) {\n  const { account, provider } = useWeb3React()\n  const allowanceProvider = useMemo(() => provider && new AllowanceProvider(provider, PERMIT2_ADDRESS), [provider])\n  const [allowanceData, setAllowanceData] = useState<AllowanceData>()\n\n  // If there is no allowanceData, recheck every block so a submitted allowance is immediately observed.\n  const blockNumber = useBlockNumber()\n  const shouldUpdate = allowanceData ? false : blockNumber\n\n  useEffect(() => {\n    if (!account || !token || !spender) return\n\n    allowanceProvider\n      ?.getAllowanceData(token.address, account, spender)\n      .then((data) => {\n        if (stale) return\n        setAllowanceData(data)\n      })\n      .catch((e) => {\n        console.warn(`Failed to fetch allowance data: ${e}`)\n      })\n\n    let stale = false\n    return () => {\n      stale = true\n    }\n  }, [account, allowanceProvider, shouldUpdate, spender, token])\n\n  return allowanceData\n}\n\ninterface Permit extends PermitSingle {\n  sigDeadline: number\n}\n\nexport interface PermitSignature extends Permit {\n  signature: string\n}\n\nexport function useUpdatePermitAllowance(\n  token: Token | undefined,\n  spender: string | undefined,\n  nonce: number | undefined,\n  onPermitSignature: (signature: PermitSignature) => void\n) {\n  const { account, chainId, provider } = useWeb3React()\n\n  return useCallback(async () => {\n    try {\n      if (!chainId) throw new Error('missing chainId')\n      if (!provider) throw new Error('missing provider')\n      if (!token) throw new Error('missing token')\n      if (!spender) throw new Error('missing spender')\n      if (nonce === undefined) throw new Error('missing nonce')\n\n      const permit: Permit = {\n        details: {\n          token: token.address,\n          amount: MaxAllowanceTransferAmount,\n          expiration: toDeadline(PERMIT_EXPIRATION),\n          nonce,\n        },\n        spender,\n        sigDeadline: toDeadline(PERMIT_SIG_EXPIRATION),\n      }\n\n      const { domain, types, values } = AllowanceTransfer.getPermitData(permit, PERMIT2_ADDRESS, chainId)\n      const signature = await provider.getSigner(account)._signTypedData(domain, types, values)\n      onPermitSignature?.({ ...permit, signature })\n      return\n    } catch (e: unknown) {\n      const symbol = token?.symbol ?? 'Token'\n      throw new Error(`${symbol} permit failed: ${e instanceof Error ? e.message : e}`)\n    }\n  }, [account, chainId, nonce, onPermitSignature, provider, spender, token])\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}