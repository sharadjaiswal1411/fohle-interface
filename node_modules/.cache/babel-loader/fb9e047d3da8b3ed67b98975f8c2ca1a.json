{"ast":null,"code":"import _objectSpread from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{useWeb3React}from'@web3-react/core';import useBlockNumber from'lib/hooks/useBlockNumber';import{useEffect,useMemo}from'react';import{useAppDispatch,useAppSelector}from'../hooks';import{fetchedLogs,fetchedLogsError,fetchingLogs}from'./slice';import{isHistoricalLog,keyToFilter}from'./utils';export default function Updater(){var dispatch=useAppDispatch();var state=useAppSelector(function(state){return state.logs;});var _useWeb3React=useWeb3React(),chainId=_useWeb3React.chainId,provider=_useWeb3React.provider;var blockNumber=useBlockNumber();var filtersNeedFetch=useMemo(function(){if(!chainId||typeof blockNumber!=='number')return[];var active=state[chainId];if(!active)return[];return Object.keys(active).filter(function(key){var _active$key=active[key],fetchingBlockNumber=_active$key.fetchingBlockNumber,results=_active$key.results,listeners=_active$key.listeners;if(listeners===0)return false;if(typeof fetchingBlockNumber==='number'&&fetchingBlockNumber>=blockNumber)return false;if(results&&typeof results.blockNumber==='number'&&results.blockNumber>=blockNumber)return false;// this condition ensures that if a log is historical, and it's already fetched, we don't re-fetch it\nif(isHistoricalLog(keyToFilter(key),blockNumber)&&(results===null||results===void 0?void 0:results.logs)!==undefined)return false;return true;}).map(function(key){return keyToFilter(key);});},[blockNumber,chainId,state]);useEffect(function(){if(!provider||!chainId||typeof blockNumber!=='number'||filtersNeedFetch.length===0)return;dispatch(fetchingLogs({chainId:chainId,filters:filtersNeedFetch,blockNumber:blockNumber}));filtersNeedFetch.forEach(function(filter){var _filter$fromBlock,_filter$toBlock;// provide defaults if {from,to}Block are missing\nvar fromBlock=(_filter$fromBlock=filter.fromBlock)!==null&&_filter$fromBlock!==void 0?_filter$fromBlock:0;var toBlock=(_filter$toBlock=filter.toBlock)!==null&&_filter$toBlock!==void 0?_filter$toBlock:blockNumber;if(typeof fromBlock==='string')fromBlock=Number.parseInt(fromBlock);if(typeof toBlock==='string')toBlock=Number.parseInt(toBlock);provider.getLogs(_objectSpread(_objectSpread({},filter),{},{fromBlock:fromBlock,toBlock:toBlock})).then(function(logs){dispatch(fetchedLogs({chainId:chainId,filter:filter,results:{logs:logs,blockNumber:blockNumber}}));}).catch(function(error){console.error('Failed to get logs',filter,error);dispatch(fetchedLogsError({chainId:chainId,filter:filter,blockNumber:blockNumber}));});});},[blockNumber,chainId,dispatch,filtersNeedFetch,provider]);return null;}","map":{"version":3,"names":["useWeb3React","useBlockNumber","useEffect","useMemo","useAppDispatch","useAppSelector","fetchedLogs","fetchedLogsError","fetchingLogs","isHistoricalLog","keyToFilter","Updater","dispatch","state","logs","chainId","provider","blockNumber","filtersNeedFetch","active","Object","keys","filter","key","fetchingBlockNumber","results","listeners","undefined","map","length","filters","forEach","fromBlock","toBlock","Number","parseInt","getLogs","then","catch","error","console"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/state/logs/updater.ts"],"sourcesContent":["import type { Filter } from '@ethersproject/providers'\nimport { useWeb3React } from '@web3-react/core'\nimport useBlockNumber from 'lib/hooks/useBlockNumber'\nimport { useEffect, useMemo } from 'react'\n\nimport { useAppDispatch, useAppSelector } from '../hooks'\nimport { fetchedLogs, fetchedLogsError, fetchingLogs } from './slice'\nimport { isHistoricalLog, keyToFilter } from './utils'\n\nexport default function Updater(): null {\n  const dispatch = useAppDispatch()\n  const state = useAppSelector((state) => state.logs)\n  const { chainId, provider } = useWeb3React()\n\n  const blockNumber = useBlockNumber()\n\n  const filtersNeedFetch: Filter[] = useMemo(() => {\n    if (!chainId || typeof blockNumber !== 'number') return []\n\n    const active = state[chainId]\n    if (!active) return []\n\n    return Object.keys(active)\n      .filter((key) => {\n        const { fetchingBlockNumber, results, listeners } = active[key]\n        if (listeners === 0) return false\n        if (typeof fetchingBlockNumber === 'number' && fetchingBlockNumber >= blockNumber) return false\n        if (results && typeof results.blockNumber === 'number' && results.blockNumber >= blockNumber) return false\n        // this condition ensures that if a log is historical, and it's already fetched, we don't re-fetch it\n        if (isHistoricalLog(keyToFilter(key), blockNumber) && results?.logs !== undefined) return false\n        return true\n      })\n      .map((key) => keyToFilter(key))\n  }, [blockNumber, chainId, state])\n\n  useEffect(() => {\n    if (!provider || !chainId || typeof blockNumber !== 'number' || filtersNeedFetch.length === 0) return\n\n    dispatch(fetchingLogs({ chainId, filters: filtersNeedFetch, blockNumber }))\n    filtersNeedFetch.forEach((filter) => {\n      // provide defaults if {from,to}Block are missing\n      let fromBlock = filter.fromBlock ?? 0\n      let toBlock = filter.toBlock ?? blockNumber\n      if (typeof fromBlock === 'string') fromBlock = Number.parseInt(fromBlock)\n      if (typeof toBlock === 'string') toBlock = Number.parseInt(toBlock)\n      provider\n        .getLogs({\n          ...filter,\n          fromBlock,\n          toBlock,\n        })\n        .then((logs) => {\n          dispatch(\n            fetchedLogs({\n              chainId,\n              filter,\n              results: { logs, blockNumber },\n            })\n          )\n        })\n        .catch((error) => {\n          console.error('Failed to get logs', filter, error)\n          dispatch(\n            fetchedLogsError({\n              chainId,\n              filter,\n              blockNumber,\n            })\n          )\n        })\n    })\n  }, [blockNumber, chainId, dispatch, filtersNeedFetch, provider])\n\n  return null\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}