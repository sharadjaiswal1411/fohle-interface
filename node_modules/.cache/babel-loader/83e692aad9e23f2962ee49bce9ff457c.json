{"ast":null,"code":"var _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { AllowanceProvider, AllowanceTransfer, MaxAllowanceTransferAmount, PERMIT2_ADDRESS } from '@uniswap/permit2-sdk';\nimport { useWeb3React } from '@web3-react/core';\nimport useBlockNumber from 'lib/hooks/useBlockNumber';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nconst PERMIT_EXPIRATION = 2592000000;\nconst PERMIT_SIG_EXPIRATION = 1800000;\nfunction toDeadline(expiration) {\n  return Math.floor((Date.now() + expiration) / 1000);\n}\nexport function usePermitAllowance(token, spender) {\n  _s();\n  const {\n    account,\n    provider\n  } = useWeb3React();\n  const allowanceProvider = useMemo(() => provider && new AllowanceProvider(provider, PERMIT2_ADDRESS), [provider]);\n  const [allowanceData, setAllowanceData] = useState();\n\n  // If there is no allowanceData, recheck every block so a submitted allowance is immediately observed.\n  const blockNumber = useBlockNumber();\n  const shouldUpdate = allowanceData ? false : blockNumber;\n  useEffect(() => {\n    if (!account || !token || !spender) return;\n    allowanceProvider === null || allowanceProvider === void 0 ? void 0 : allowanceProvider.getAllowanceData(token.address, account, spender).then(data => {\n      if (stale) return;\n      setAllowanceData(data);\n    }).catch(e => {\n      console.warn(`Failed to fetch allowance data: ${e}`);\n    });\n    let stale = false;\n    return () => {\n      stale = true;\n    };\n  }, [account, allowanceProvider, shouldUpdate, spender, token]);\n  return allowanceData;\n}\n_s(usePermitAllowance, \"Py/uRGV439LC+Q8lGF38uzDburI=\", false, function () {\n  return [useWeb3React, useBlockNumber];\n});\nexport function useUpdatePermitAllowance(token, spender, nonce, onPermitSignature) {\n  _s2();\n  const {\n    account,\n    chainId,\n    provider\n  } = useWeb3React();\n  return useCallback(async () => {\n    try {\n      if (!chainId) throw new Error('missing chainId');\n      if (!provider) throw new Error('missing provider');\n      if (!token) throw new Error('missing token');\n      if (!spender) throw new Error('missing spender');\n      if (nonce === undefined) throw new Error('missing nonce');\n      const permit = {\n        details: {\n          token: token.address,\n          amount: MaxAllowanceTransferAmount,\n          expiration: toDeadline(PERMIT_EXPIRATION),\n          nonce\n        },\n        spender,\n        sigDeadline: toDeadline(PERMIT_SIG_EXPIRATION)\n      };\n      const {\n        domain,\n        types,\n        values\n      } = AllowanceTransfer.getPermitData(permit, PERMIT2_ADDRESS, chainId);\n      const signature = await provider.getSigner(account)._signTypedData(domain, types, values);\n      onPermitSignature === null || onPermitSignature === void 0 ? void 0 : onPermitSignature({\n        ...permit,\n        signature\n      });\n      return;\n    } catch (e) {\n      var _token$symbol;\n      const symbol = (_token$symbol = token === null || token === void 0 ? void 0 : token.symbol) !== null && _token$symbol !== void 0 ? _token$symbol : 'Token';\n      throw new Error(`${symbol} permit failed: ${e instanceof Error ? e.message : e}`);\n    }\n  }, [account, chainId, nonce, onPermitSignature, provider, spender, token]);\n}\n_s2(useUpdatePermitAllowance, \"Er43l/h37JfIIXMK+0pJt5mfuPM=\", false, function () {\n  return [useWeb3React];\n});","map":{"version":3,"names":["AllowanceProvider","AllowanceTransfer","MaxAllowanceTransferAmount","PERMIT2_ADDRESS","useWeb3React","useBlockNumber","useCallback","useEffect","useMemo","useState","PERMIT_EXPIRATION","PERMIT_SIG_EXPIRATION","toDeadline","expiration","Math","floor","Date","now","usePermitAllowance","token","spender","account","provider","allowanceProvider","allowanceData","setAllowanceData","blockNumber","shouldUpdate","getAllowanceData","address","then","data","stale","catch","e","console","warn","useUpdatePermitAllowance","nonce","onPermitSignature","chainId","Error","undefined","permit","details","amount","sigDeadline","domain","types","values","getPermitData","signature","getSigner","_signTypedData","symbol","message"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/hooks/usePermitAllowance.ts"],"sourcesContent":["import {\n  AllowanceData,\n  AllowanceProvider,\n  AllowanceTransfer,\n  MaxAllowanceTransferAmount,\n  PERMIT2_ADDRESS,\n  PermitSingle,\n} from '@uniswap/permit2-sdk'\nimport { Token } from '@uniswap/sdk-core'\nimport { useWeb3React } from '@web3-react/core'\nimport useBlockNumber from 'lib/hooks/useBlockNumber'\nimport ms from 'ms.macro'\nimport { useCallback, useEffect, useMemo, useState } from 'react'\n\nconst PERMIT_EXPIRATION = ms`30d`\nconst PERMIT_SIG_EXPIRATION = ms`30m`\n\nfunction toDeadline(expiration: number): number {\n  return Math.floor((Date.now() + expiration) / 1000)\n}\n\nexport function usePermitAllowance(token?: Token, spender?: string) {\n  const { account, provider } = useWeb3React()\n  const allowanceProvider = useMemo(() => provider && new AllowanceProvider(provider, PERMIT2_ADDRESS), [provider])\n  const [allowanceData, setAllowanceData] = useState<AllowanceData>()\n\n  // If there is no allowanceData, recheck every block so a submitted allowance is immediately observed.\n  const blockNumber = useBlockNumber()\n  const shouldUpdate = allowanceData ? false : blockNumber\n\n  useEffect(() => {\n    if (!account || !token || !spender) return\n\n    allowanceProvider\n      ?.getAllowanceData(token.address, account, spender)\n      .then((data) => {\n        if (stale) return\n        setAllowanceData(data)\n      })\n      .catch((e) => {\n        console.warn(`Failed to fetch allowance data: ${e}`)\n      })\n\n    let stale = false\n    return () => {\n      stale = true\n    }\n  }, [account, allowanceProvider, shouldUpdate, spender, token])\n\n  return allowanceData\n}\n\ninterface Permit extends PermitSingle {\n  sigDeadline: number\n}\n\nexport interface PermitSignature extends Permit {\n  signature: string\n}\n\nexport function useUpdatePermitAllowance(\n  token: Token | undefined,\n  spender: string | undefined,\n  nonce: number | undefined,\n  onPermitSignature: (signature: PermitSignature) => void\n) {\n  const { account, chainId, provider } = useWeb3React()\n\n  return useCallback(async () => {\n    try {\n      if (!chainId) throw new Error('missing chainId')\n      if (!provider) throw new Error('missing provider')\n      if (!token) throw new Error('missing token')\n      if (!spender) throw new Error('missing spender')\n      if (nonce === undefined) throw new Error('missing nonce')\n\n      const permit: Permit = {\n        details: {\n          token: token.address,\n          amount: MaxAllowanceTransferAmount,\n          expiration: toDeadline(PERMIT_EXPIRATION),\n          nonce,\n        },\n        spender,\n        sigDeadline: toDeadline(PERMIT_SIG_EXPIRATION),\n      }\n\n      const { domain, types, values } = AllowanceTransfer.getPermitData(permit, PERMIT2_ADDRESS, chainId)\n      const signature = await provider.getSigner(account)._signTypedData(domain, types, values)\n      onPermitSignature?.({ ...permit, signature })\n      return\n    } catch (e: unknown) {\n      const symbol = token?.symbol ?? 'Token'\n      throw new Error(`${symbol} permit failed: ${e instanceof Error ? e.message : e}`)\n    }\n  }, [account, chainId, nonce, onPermitSignature, provider, spender, token])\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}