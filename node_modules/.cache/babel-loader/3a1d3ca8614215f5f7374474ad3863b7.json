{"ast":null,"code":"import _regeneratorRuntime from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _createClass from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _classCallCheck from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _inherits from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _wrapNativeSuper from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";function wait(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});}function waitRandom(min,max){return wait(min+Math.round(Math.random()*Math.max(0,max-min)));}/**\n * This error is thrown if the function is cancelled before completing\n */var CancelledError=/*#__PURE__*/function(_Error){_inherits(CancelledError,_Error);var _super=_createSuper(CancelledError);function CancelledError(){var _this;_classCallCheck(this,CancelledError);_this=_super.call(this,'Cancelled');_this.isCancelledError=true;return _this;}return _createClass(CancelledError);}(/*#__PURE__*/_wrapNativeSuper(Error));/**\n * Throw this error if the function should retry\n */export var RetryableError=/*#__PURE__*/function(_Error2){_inherits(RetryableError,_Error2);var _super2=_createSuper(RetryableError);function RetryableError(){var _this2;_classCallCheck(this,RetryableError);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.isRetryableError=true;return _this2;}return _createClass(RetryableError);}(/*#__PURE__*/_wrapNativeSuper(Error));/**\n * Retries the function that returns the promise until the promise successfully resolves up to n retries\n * @param fn function to retry\n * @param n how many times to retry\n * @param minWait min wait between retries in ms\n * @param maxWait max wait between retries in ms\n */export function retry(fn,_ref){var n=_ref.n,minWait=_ref.minWait,maxWait=_ref.maxWait;var completed=false;var rejectCancelled;// eslint-disable-next-line no-async-promise-executor\nvar promise=new Promise(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(resolve,reject){var result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:rejectCancelled=reject;// eslint-disable-next-line no-constant-condition\ncase 1:if(!true){_context.next=24;break;}result=void 0;_context.prev=3;_context.next=6;return fn();case 6:result=_context.sent;if(!completed){resolve(result);completed=true;}return _context.abrupt(\"break\",24);case 11:_context.prev=11;_context.t0=_context[\"catch\"](3);if(!completed){_context.next=15;break;}return _context.abrupt(\"break\",24);case 15:if(!(n<=0||!_context.t0.isRetryableError)){_context.next=19;break;}reject(_context.t0);completed=true;return _context.abrupt(\"break\",24);case 19:n--;case 20:_context.next=22;return waitRandom(minWait,maxWait);case 22:_context.next=1;break;case 24:case\"end\":return _context.stop();}}},_callee,null,[[3,11]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());return{promise:promise,cancel:function cancel(){if(completed)return;completed=true;rejectCancelled(new CancelledError());}};}","map":{"version":3,"names":["wait","ms","Promise","resolve","setTimeout","waitRandom","min","max","Math","round","random","CancelledError","isCancelledError","Error","RetryableError","isRetryableError","retry","fn","n","minWait","maxWait","completed","rejectCancelled","promise","reject","result","cancel"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/utils/retry.ts"],"sourcesContent":["function wait(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\nfunction waitRandom(min: number, max: number): Promise<void> {\n  return wait(min + Math.round(Math.random() * Math.max(0, max - min)))\n}\n\n/**\n * This error is thrown if the function is cancelled before completing\n */\nclass CancelledError extends Error {\n  public isCancelledError = true as const\n  constructor() {\n    super('Cancelled')\n  }\n}\n\n/**\n * Throw this error if the function should retry\n */\nexport class RetryableError extends Error {\n  public isRetryableError = true as const\n}\n\nexport interface RetryOptions {\n  n: number\n  minWait: number\n  maxWait: number\n}\n\n/**\n * Retries the function that returns the promise until the promise successfully resolves up to n retries\n * @param fn function to retry\n * @param n how many times to retry\n * @param minWait min wait between retries in ms\n * @param maxWait max wait between retries in ms\n */\nexport function retry<T>(\n  fn: () => Promise<T>,\n  { n, minWait, maxWait }: RetryOptions\n): { promise: Promise<T>; cancel: () => void } {\n  let completed = false\n  let rejectCancelled: (error: Error) => void\n  // eslint-disable-next-line no-async-promise-executor\n  const promise = new Promise<T>(async (resolve, reject) => {\n    rejectCancelled = reject\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      let result: T\n      try {\n        result = await fn()\n        if (!completed) {\n          resolve(result)\n          completed = true\n        }\n        break\n      } catch (error) {\n        if (completed) {\n          break\n        }\n        if (n <= 0 || !error.isRetryableError) {\n          reject(error)\n          completed = true\n          break\n        }\n        n--\n      }\n      await waitRandom(minWait, maxWait)\n    }\n  })\n  return {\n    promise,\n    cancel: () => {\n      if (completed) return\n      completed = true\n      rejectCancelled(new CancelledError())\n    },\n  }\n}\n"],"mappings":"qqCAAA,QAASA,KAAI,CAACC,EAAU,CAAiB,CACvC,MAAO,IAAIC,QAAO,CAAC,SAACC,OAAO,QAAKC,WAAU,CAACD,OAAO,CAAEF,EAAE,CAAC,GAAC,CAC1D,CAEA,QAASI,WAAU,CAACC,GAAW,CAAEC,GAAW,CAAiB,CAC3D,MAAOP,KAAI,CAACM,GAAG,CAAGE,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,CAAGF,IAAI,CAACD,GAAG,CAAC,CAAC,CAAEA,GAAG,CAAGD,GAAG,CAAC,CAAC,CAAC,CACvE,CAEA;AACA;AACA,GAFA,GAGMK,eAAc,wGAElB,yBAAc,gDACZ,uBAAM,WAAW,EAAC,MAFbC,gBAAgB,CAAG,IAAI,cAG9B,CAAC,oEAJ0BC,KAAK,GAOlC;AACA;AACA,GACA,UAAaC,eAAc,2VAClBC,gBAAgB,CAAG,IAAI,oFADIF,KAAK,GAUzC;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,SAASG,MAAK,CACnBC,EAAoB,MAEyB,IAD3CC,EAAC,MAADA,CAAC,CAAEC,OAAO,MAAPA,OAAO,CAAEC,OAAO,MAAPA,OAAO,CAErB,GAAIC,UAAS,CAAG,KAAK,CACrB,GAAIC,gBAAuC,CAC3C;AACA,GAAMC,QAAO,CAAG,GAAIrB,QAAO,2FAAI,iBAAOC,OAAO,CAAEqB,MAAM,6HACnDF,eAAe,CAAGE,MAAM,CACxB;AAAA,WACO,IAAI,0BACLC,MAAS,8CAEIR,GAAE,EAAE,QAAnBQ,MAAM,eACN,GAAI,CAACJ,SAAS,CAAE,CACdlB,OAAO,CAACsB,MAAM,CAAC,CACfJ,SAAS,CAAG,IAAI,CAClB,CAAC,iGAGGA,SAAS,0EAGTH,CAAC,EAAI,CAAC,EAAI,CAAC,YAAMH,gBAAgB,2BACnCS,MAAM,aAAO,CACbH,SAAS,CAAG,IAAI,4CAGlBH,CAAC,EAAE,gCAECb,WAAU,CAACc,OAAO,CAAEC,OAAO,CAAC,oGAErC,oEAAC,CACF,MAAO,CACLG,OAAO,CAAPA,OAAO,CACPG,MAAM,CAAE,iBAAM,CACZ,GAAIL,SAAS,CAAE,OACfA,SAAS,CAAG,IAAI,CAChBC,eAAe,CAAC,GAAIX,eAAc,EAAE,CAAC,CACvC,CACF,CAAC,CACH"},"metadata":{},"sourceType":"module"}