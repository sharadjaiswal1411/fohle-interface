{"ast":null,"code":"import _slicedToArray from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{initialCollectionFilterState,SortByPointers}from'nft/hooks';import qs from'query-string';var trimTraitStr=function trimTraitStr(trait){return trait.substring(1,trait.length-1);};var urlParamsUtils={removeDefaults:function removeDefaults(query){var clonedQuery=_objectSpread({},query);// Leveraging default values & not showing them on URL\nfor(var key in clonedQuery){var valueInQuery=clonedQuery[key];var initialValue=initialCollectionFilterState[key];if(JSON.stringify(valueInQuery)===JSON.stringify(initialValue)){delete clonedQuery[key];}}// Doing this one manually due to name mismatch - \"all\" in url, \"buyNow\" in state\nif(clonedQuery['all']!==initialCollectionFilterState.buyNow){delete clonedQuery['all'];}var defaultSortByPointer=SortByPointers[initialCollectionFilterState.sortBy];if(clonedQuery['sort']===defaultSortByPointer){delete clonedQuery['sort'];}return clonedQuery;},// Making values in our URL more state-friendly\nbuildQuery:function buildQuery(query,collectionStats){var clonedQuery=_objectSpread({},query);var filters=['traits','markets'];filters.forEach(function(key){if(!clonedQuery[key]){clonedQuery[key]=[];}/* \n        query-string package treats arrays with one value as a string.\n        Here we're making sure that we have an array, not a string. Example:\n          const foo = 'hey' // => ['hey']\n      */if(clonedQuery[key]&&typeof clonedQuery[key]==='string'){clonedQuery[key]=[clonedQuery[key]];}});try{var initialBuyNow=initialCollectionFilterState.buyNow,initialSearchText=initialCollectionFilterState.search;Object.entries(SortByPointers).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];if(value===clonedQuery['sort']){clonedQuery['sortBy']=Number(key);}});clonedQuery['buyNow']=!(clonedQuery['all']===undefined?!initialBuyNow:clonedQuery['all']);clonedQuery['search']=clonedQuery['search']===undefined?initialSearchText:String(clonedQuery['search']);/*\n        Handling an edge case caused by query-string's bad array parsing, when user\n        only selects one trait and reloads the page.\n        Here's the general data-structure for our traits in URL: \n          `traits=(\"trait_type\",\"trait_value\"),(\"trait_type\",\"trait_value\")`\n\n        Expected behavior: When user selects one trait, there should be an array\n        containing one element.\n\n        Actual behavior: It creates an array with two elements, first element being\n        trait_type & the other trait_value. This causes confusion since we don't know\n        whether user has selected two traits (cause we have two elements in our array)\n        or it's only one.\n\n        Using this block of code, we'll identify if that's the case.\n      */if(clonedQuery['traits'].length===2){var _ref3=clonedQuery['traits'],_ref4=_slicedToArray(_ref3,2),trait_type=_ref4[0],trait_value=_ref4[1];var fullTrait=\"\".concat(trait_type).concat(trait_value);if(!fullTrait.includes(',')){if(trait_type.startsWith('(')&&!trait_type.endsWith(')')&&trait_value.endsWith(')')&&!trait_value.startsWith('('))clonedQuery['traits']=[\"\".concat(trait_type,\",\").concat(trait_value)];}}clonedQuery['traits']=clonedQuery['traits'].map(function(queryTrait){var modifiedTrait=trimTraitStr(queryTrait.replace(/(\")/g,''));var _modifiedTrait$split=modifiedTrait.split(','),_modifiedTrait$split2=_slicedToArray(_modifiedTrait$split,2),trait_type=_modifiedTrait$split2[0],trait_value=_modifiedTrait$split2[1];var traitInStats=collectionStats.traits&&collectionStats.traits[trait_type].find(function(trait){return trait.trait_value===trait_value;});/*\n          For most cases, `traitInStats` is assigned. In case the trait\n          does not exist in our store, e.g \"Number of traits\", we have to\n          manually create an object for it.\n        */var trait=traitInStats!==null&&traitInStats!==void 0?traitInStats:{trait_type:trait_type,trait_value:trait_value,trait_count:0};return trait;});}catch(err){clonedQuery['traits']=[];}return clonedQuery;}};export var syncLocalFiltersWithURL=function syncLocalFiltersWithURL(state){var urlFilterItems=['markets','maxPrice','maxRarity','minPrice','minRarity','traits','all','search','sort'];var query={};urlFilterItems.forEach(function(key){switch(key){case'traits':{var traits=state.traits.map(function(_ref5){var trait_type=_ref5.trait_type,trait_value=_ref5.trait_value;return\"(\\\"\".concat(trait_type,\"\\\",\\\"\").concat(trait_value,\"\\\")\");});query['traits']=traits;break;}case'all':query['all']=!state.buyNow;break;case'sort':query['sort']=SortByPointers[state.sortBy];break;default:query[key]=state[key];break;}});var modifiedQuery=urlParamsUtils.removeDefaults(query);// Applying local state changes to URL\nvar url=window.location.href.split('?')[0];var stringifiedQuery=qs.stringify(modifiedQuery,{arrayFormat:'comma'});// Using window.history directly on purpose here. router.push() will trigger re-renders & API calls.\nwindow.history.replaceState({},\"\",\"\".concat(url).concat(stringifiedQuery&&\"?\".concat(stringifiedQuery)));};export var applyFiltersFromURL=function applyFiltersFromURL(location,collectionStats){if(!location.search)return;var query=qs.parse(location.search,{arrayFormat:'comma',parseNumbers:true,parseBooleans:true});var modifiedQuery=urlParamsUtils.buildQuery(query,collectionStats);return modifiedQuery;};","map":{"version":3,"names":["initialCollectionFilterState","SortByPointers","qs","trimTraitStr","trait","substring","length","urlParamsUtils","removeDefaults","query","clonedQuery","key","valueInQuery","initialValue","JSON","stringify","buyNow","defaultSortByPointer","sortBy","buildQuery","collectionStats","filters","forEach","initialBuyNow","initialSearchText","search","Object","entries","value","Number","undefined","String","trait_type","trait_value","fullTrait","includes","startsWith","endsWith","map","queryTrait","modifiedTrait","replace","split","traitInStats","traits","find","trait_count","err","syncLocalFiltersWithURL","state","urlFilterItems","modifiedQuery","url","window","location","href","stringifiedQuery","arrayFormat","history","replaceState","applyFiltersFromURL","parse","parseNumbers","parseBooleans"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/nft/utils/urlParams.ts"],"sourcesContent":["import { CollectionFilters, initialCollectionFilterState, SortByPointers, Trait } from 'nft/hooks'\nimport { GenieCollection } from 'nft/types'\nimport qs from 'query-string'\nimport { Location } from 'react-router-dom'\n\nconst trimTraitStr = (trait: string) => {\n  return trait.substring(1, trait.length - 1)\n}\n\nconst urlParamsUtils = {\n  removeDefaults: (query: Record<string, any>) => {\n    const clonedQuery: Record<string, any> = { ...query }\n\n    // Leveraging default values & not showing them on URL\n    for (const key in clonedQuery) {\n      const valueInQuery = clonedQuery[key]\n      const initialValue = initialCollectionFilterState[key as keyof typeof initialCollectionFilterState]\n\n      if (JSON.stringify(valueInQuery) === JSON.stringify(initialValue)) {\n        delete clonedQuery[key]\n      }\n    }\n\n    // Doing this one manually due to name mismatch - \"all\" in url, \"buyNow\" in state\n    if (clonedQuery['all'] !== initialCollectionFilterState.buyNow) {\n      delete clonedQuery['all']\n    }\n\n    const defaultSortByPointer = SortByPointers[initialCollectionFilterState.sortBy]\n    if (clonedQuery['sort'] === defaultSortByPointer) {\n      delete clonedQuery['sort']\n    }\n\n    return clonedQuery\n  },\n\n  // Making values in our URL more state-friendly\n  buildQuery: (query: Record<string, any>, collectionStats: GenieCollection) => {\n    const clonedQuery: Record<string, any> = { ...query }\n    const filters = ['traits', 'markets']\n\n    filters.forEach((key) => {\n      if (!clonedQuery[key]) {\n        clonedQuery[key] = []\n      }\n\n      /* \n        query-string package treats arrays with one value as a string.\n        Here we're making sure that we have an array, not a string. Example:\n          const foo = 'hey' // => ['hey']\n      */\n      if (clonedQuery[key] && typeof clonedQuery[key] === 'string') {\n        clonedQuery[key] = [clonedQuery[key]]\n      }\n    })\n\n    try {\n      const { buyNow: initialBuyNow, search: initialSearchText } = initialCollectionFilterState\n\n      Object.entries(SortByPointers).forEach(([key, value]) => {\n        if (value === clonedQuery['sort']) {\n          clonedQuery['sortBy'] = Number(key)\n        }\n      })\n\n      clonedQuery['buyNow'] = !(clonedQuery['all'] === undefined ? !initialBuyNow : clonedQuery['all'])\n      clonedQuery['search'] = clonedQuery['search'] === undefined ? initialSearchText : String(clonedQuery['search'])\n\n      /*\n        Handling an edge case caused by query-string's bad array parsing, when user\n        only selects one trait and reloads the page.\n        Here's the general data-structure for our traits in URL: \n          `traits=(\"trait_type\",\"trait_value\"),(\"trait_type\",\"trait_value\")`\n\n        Expected behavior: When user selects one trait, there should be an array\n        containing one element.\n\n        Actual behavior: It creates an array with two elements, first element being\n        trait_type & the other trait_value. This causes confusion since we don't know\n        whether user has selected two traits (cause we have two elements in our array)\n        or it's only one.\n\n        Using this block of code, we'll identify if that's the case.\n      */\n\n      if (clonedQuery['traits'].length === 2) {\n        const [trait_type, trait_value] = clonedQuery['traits'] as [string, string]\n        const fullTrait = `${trait_type}${trait_value}`\n        if (!fullTrait.includes(',')) {\n          if (\n            trait_type.startsWith('(') &&\n            !trait_type.endsWith(')') &&\n            trait_value.endsWith(')') &&\n            !trait_value.startsWith('(')\n          )\n            clonedQuery['traits'] = [`${trait_type},${trait_value}`]\n        }\n      }\n\n      clonedQuery['traits'] = clonedQuery['traits'].map((queryTrait: string) => {\n        const modifiedTrait = trimTraitStr(queryTrait.replace(/(\")/g, ''))\n        const [trait_type, trait_value] = modifiedTrait.split(',')\n        const traitInStats =\n          collectionStats.traits &&\n          collectionStats.traits[trait_type].find((trait) => trait.trait_value === trait_value)\n\n        /*\n          For most cases, `traitInStats` is assigned. In case the trait\n          does not exist in our store, e.g \"Number of traits\", we have to\n          manually create an object for it.\n        */\n        const trait = traitInStats ?? { trait_type, trait_value, trait_count: 0 }\n\n        return trait as Trait\n      })\n    } catch (err) {\n      clonedQuery['traits'] = []\n    }\n\n    return clonedQuery\n  },\n}\n\nexport const syncLocalFiltersWithURL = (state: CollectionFilters) => {\n  const urlFilterItems = [\n    'markets',\n    'maxPrice',\n    'maxRarity',\n    'minPrice',\n    'minRarity',\n    'traits',\n    'all',\n    'search',\n    'sort',\n  ] as const\n\n  const query: Record<string, any> = {}\n  urlFilterItems.forEach((key) => {\n    switch (key) {\n      case 'traits': {\n        const traits = state.traits.map(({ trait_type, trait_value }) => `(\"${trait_type}\",\"${trait_value}\")`)\n        query['traits'] = traits\n        break\n      }\n      case 'all':\n        query['all'] = !state.buyNow\n        break\n\n      case 'sort':\n        query['sort'] = SortByPointers[state.sortBy]\n        break\n\n      default:\n        query[key] = state[key]\n        break\n    }\n  })\n\n  const modifiedQuery = urlParamsUtils.removeDefaults(query)\n\n  // Applying local state changes to URL\n  const url = window.location.href.split('?')[0]\n  const stringifiedQuery = qs.stringify(modifiedQuery, { arrayFormat: 'comma' })\n\n  // Using window.history directly on purpose here. router.push() will trigger re-renders & API calls.\n  window.history.replaceState({}, ``, `${url}${stringifiedQuery && `?${stringifiedQuery}`}`)\n}\n\nexport const applyFiltersFromURL = (location: Location, collectionStats: GenieCollection) => {\n  if (!location.search) return\n\n  const query = qs.parse(location.search, {\n    arrayFormat: 'comma',\n    parseNumbers: true,\n    parseBooleans: true,\n  }) as {\n    maxPrice: string\n    maxRarity: string\n    minPrice: string\n    minRarity: string\n    search: string\n    sort: string\n    sortBy: number\n    all: boolean\n    buyNow: boolean\n    traits: string[]\n    markets: string[]\n  }\n  const modifiedQuery = urlParamsUtils.buildQuery(query, collectionStats)\n\n  return modifiedQuery\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}