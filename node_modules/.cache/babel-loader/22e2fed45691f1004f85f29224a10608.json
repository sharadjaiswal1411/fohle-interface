{"ast":null,"code":"import { createTransport } from '@sentry/core';\nimport { SyncPromise } from '@sentry/utils';\n\n/**\n * The DONE ready state for XmlHttpRequest\n *\n * Defining it here as a constant b/c XMLHttpRequest.DONE is not always defined\n * (e.g. during testing, it is `undefined`)\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState}\n */\nconst XHR_READYSTATE_DONE = 4;\n\n/**\n * Creates a Transport that uses the XMLHttpRequest API to send events to Sentry.\n */\nfunction makeXHRTransport(options) {\n  function makeRequest(request) {\n    return new SyncPromise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.onerror = reject;\n      xhr.onreadystatechange = () => {\n        if (xhr.readyState === XHR_READYSTATE_DONE) {\n          resolve({\n            statusCode: xhr.status,\n            headers: {\n              'x-sentry-rate-limits': xhr.getResponseHeader('X-Sentry-Rate-Limits'),\n              'retry-after': xhr.getResponseHeader('Retry-After')\n            }\n          });\n        }\n      };\n      xhr.open('POST', options.url);\n      for (const header in options.headers) {\n        if (Object.prototype.hasOwnProperty.call(options.headers, header)) {\n          xhr.setRequestHeader(header, options.headers[header]);\n        }\n      }\n      xhr.send(request.body);\n    });\n  }\n  return createTransport(options, makeRequest);\n}\nexport { makeXHRTransport };","map":{"version":3,"sources":["../../../../src/transports/xhr.ts"],"names":[],"mappings":";;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAA,mBAAA,GAAA,CAAA;;AAEA;AACA;AACA;AACA,SAAA,gBAAA,CAAA,OAAA,EAAA;EACA,SAAA,WAAA,CAAA,OAAA,EAAA;IACA,OAAA,IAAA,WAAA,CAAA,CAAA,OAAA,EAAA,MAAA,KAAA;MACA,MAAA,GAAA,GAAA,IAAA,cAAA,EAAA;MAEA,GAAA,CAAA,OAAA,GAAA,MAAA;MAEA,GAAA,CAAA,kBAAA,GAAA,MAAA;QACA,IAAA,GAAA,CAAA,UAAA,KAAA,mBAAA,EAAA;UACA,OAAA,CAAA;YACA,UAAA,EAAA,GAAA,CAAA,MAAA;YACA,OAAA,EAAA;cACA,sBAAA,EAAA,GAAA,CAAA,iBAAA,CAAA,sBAAA,CAAA;cACA,aAAA,EAAA,GAAA,CAAA,iBAAA,CAAA,aAAA;YACA;UACA,CAAA,CAAA;QACA;MACA,CAAA;MAEA,GAAA,CAAA,IAAA,CAAA,MAAA,EAAA,OAAA,CAAA,GAAA,CAAA;MAEA,KAAA,MAAA,MAAA,IAAA,OAAA,CAAA,OAAA,EAAA;QACA,IAAA,MAAA,CAAA,SAAA,CAAA,cAAA,CAAA,IAAA,CAAA,OAAA,CAAA,OAAA,EAAA,MAAA,CAAA,EAAA;UACA,GAAA,CAAA,gBAAA,CAAA,MAAA,EAAA,OAAA,CAAA,OAAA,CAAA,MAAA,CAAA,CAAA;QACA;MACA;MAEA,GAAA,CAAA,IAAA,CAAA,OAAA,CAAA,IAAA,CAAA;IACA,CAAA,CAAA;EACA;EAEA,OAAA,eAAA,CAAA,OAAA,EAAA,WAAA,CAAA;AACA","sourcesContent":["import { createTransport } from '@sentry/core';\nimport { Transport, TransportMakeRequestResponse, TransportRequest } from '@sentry/types';\nimport { SyncPromise } from '@sentry/utils';\n\nimport { BrowserTransportOptions } from './types';\n\n/**\n * The DONE ready state for XmlHttpRequest\n *\n * Defining it here as a constant b/c XMLHttpRequest.DONE is not always defined\n * (e.g. during testing, it is `undefined`)\n *\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState}\n */\nconst XHR_READYSTATE_DONE = 4;\n\n/**\n * Creates a Transport that uses the XMLHttpRequest API to send events to Sentry.\n */\nexport function makeXHRTransport(options: BrowserTransportOptions): Transport {\n  function makeRequest(request: TransportRequest): PromiseLike<TransportMakeRequestResponse> {\n    return new SyncPromise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n\n      xhr.onerror = reject;\n\n      xhr.onreadystatechange = (): void => {\n        if (xhr.readyState === XHR_READYSTATE_DONE) {\n          resolve({\n            statusCode: xhr.status,\n            headers: {\n              'x-sentry-rate-limits': xhr.getResponseHeader('X-Sentry-Rate-Limits'),\n              'retry-after': xhr.getResponseHeader('Retry-After'),\n            },\n          });\n        }\n      };\n\n      xhr.open('POST', options.url);\n\n      for (const header in options.headers) {\n        if (Object.prototype.hasOwnProperty.call(options.headers, header)) {\n          xhr.setRequestHeader(header, options.headers[header]);\n        }\n      }\n\n      xhr.send(request.body);\n    });\n  }\n\n  return createTransport(options, makeRequest);\n}\n"]},"metadata":{},"sourceType":"module"}