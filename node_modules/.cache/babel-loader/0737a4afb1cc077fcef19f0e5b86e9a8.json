{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\nvar _asyncToGenerator = require(\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\nvar _classCallCheck = require(\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\nvar _createClass = require(\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Safe = void 0;\nvar ethers_1 = require(\"ethers\");\nvar signatures_1 = require(\"./signatures\");\nvar methods_1 = require(\"../communication/methods\");\nvar constants_1 = require(\"../eth/constants\");\nvar requirePermissions_1 = __importDefault(require(\"../decorators/requirePermissions\"));\nvar Safe = /*#__PURE__*/function () {\n  function Safe(communicator) {\n    _classCallCheck(this, Safe);\n    this.communicator = communicator;\n  }\n  _createClass(Safe, [{\n    key: \"getChainInfo\",\n    value: function () {\n      var _getChainInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.communicator.send(methods_1.Methods.getChainInfo, undefined);\n              case 2:\n                response = _context.sent;\n                return _context.abrupt(\"return\", response.data);\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function getChainInfo() {\n        return _getChainInfo.apply(this, arguments);\n      }\n      return getChainInfo;\n    }()\n  }, {\n    key: \"getInfo\",\n    value: function () {\n      var _getInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.communicator.send(methods_1.Methods.getSafeInfo, undefined);\n              case 2:\n                response = _context2.sent;\n                return _context2.abrupt(\"return\", response.data);\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function getInfo() {\n        return _getInfo.apply(this, arguments);\n      }\n      return getInfo;\n    }() // There is a possibility that this method will change because we may add pagination to the endpoint\n  }, {\n    key: \"experimental_getBalances\",\n    value: function () {\n      var _experimental_getBalances = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _ref,\n          _ref$currency,\n          currency,\n          response,\n          _args3 = arguments;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _ref = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : {}, _ref$currency = _ref.currency, currency = _ref$currency === void 0 ? 'usd' : _ref$currency;\n                _context3.next = 3;\n                return this.communicator.send(methods_1.Methods.getSafeBalances, {\n                  currency: currency\n                });\n              case 3:\n                response = _context3.sent;\n                return _context3.abrupt(\"return\", response.data);\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n      function experimental_getBalances() {\n        return _experimental_getBalances.apply(this, arguments);\n      }\n      return experimental_getBalances;\n    }()\n  }, {\n    key: \"check1271Signature\",\n    value: function () {\n      var _check1271Signature = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(messageHash) {\n        var signature,\n          safeInfo,\n          encodedIsValidSignatureCall,\n          payload,\n          response,\n          _args4 = arguments;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                signature = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : '0x';\n                _context4.next = 3;\n                return this.getInfo();\n              case 3:\n                safeInfo = _context4.sent;\n                encodedIsValidSignatureCall = signatures_1.EIP_1271_INTERFACE.encodeFunctionData('isValidSignature', [messageHash, signature]);\n                payload = {\n                  call: constants_1.RPC_CALLS.eth_call,\n                  params: [{\n                    to: safeInfo.safeAddress,\n                    data: encodedIsValidSignatureCall\n                  }, 'latest']\n                };\n                _context4.prev = 6;\n                _context4.next = 9;\n                return this.communicator.send(methods_1.Methods.rpcCall, payload);\n              case 9:\n                response = _context4.sent;\n                return _context4.abrupt(\"return\", response.data.slice(0, 10).toLowerCase() === signatures_1.MAGIC_VALUE);\n              case 13:\n                _context4.prev = 13;\n                _context4.t0 = _context4[\"catch\"](6);\n                return _context4.abrupt(\"return\", false);\n              case 16:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[6, 13]]);\n      }));\n      function check1271Signature(_x) {\n        return _check1271Signature.apply(this, arguments);\n      }\n      return check1271Signature;\n    }()\n  }, {\n    key: \"check1271SignatureBytes\",\n    value: function () {\n      var _check1271SignatureBytes = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(messageHash) {\n        var signature,\n          safeInfo,\n          msgBytes,\n          encodedIsValidSignatureCall,\n          payload,\n          response,\n          _args5 = arguments;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                signature = _args5.length > 1 && _args5[1] !== undefined ? _args5[1] : '0x';\n                _context5.next = 3;\n                return this.getInfo();\n              case 3:\n                safeInfo = _context5.sent;\n                msgBytes = ethers_1.ethers.utils.arrayify(messageHash);\n                encodedIsValidSignatureCall = signatures_1.EIP_1271_BYTES_INTERFACE.encodeFunctionData('isValidSignature', [msgBytes, signature]);\n                payload = {\n                  call: constants_1.RPC_CALLS.eth_call,\n                  params: [{\n                    to: safeInfo.safeAddress,\n                    data: encodedIsValidSignatureCall\n                  }, 'latest']\n                };\n                _context5.prev = 7;\n                _context5.next = 10;\n                return this.communicator.send(methods_1.Methods.rpcCall, payload);\n              case 10:\n                response = _context5.sent;\n                return _context5.abrupt(\"return\", response.data.slice(0, 10).toLowerCase() === signatures_1.MAGIC_VALUE_BYTES);\n              case 14:\n                _context5.prev = 14;\n                _context5.t0 = _context5[\"catch\"](7);\n                return _context5.abrupt(\"return\", false);\n              case 17:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[7, 14]]);\n      }));\n      function check1271SignatureBytes(_x2) {\n        return _check1271SignatureBytes.apply(this, arguments);\n      }\n      return check1271SignatureBytes;\n    }()\n  }, {\n    key: \"calculateMessageHash\",\n    value: function calculateMessageHash(message) {\n      return ethers_1.ethers.utils.hashMessage(message);\n    }\n  }, {\n    key: \"isMessageSigned\",\n    value: function () {\n      var _isMessageSigned = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(message) {\n        var signature,\n          messageHash,\n          messageHashSigned,\n          _args6 = arguments;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                signature = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : '0x';\n                messageHash = this.calculateMessageHash(message);\n                _context6.next = 4;\n                return this.isMessageHashSigned(messageHash, signature);\n              case 4:\n                messageHashSigned = _context6.sent;\n                return _context6.abrupt(\"return\", messageHashSigned);\n              case 6:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n      function isMessageSigned(_x3) {\n        return _isMessageSigned.apply(this, arguments);\n      }\n      return isMessageSigned;\n    }()\n  }, {\n    key: \"isMessageHashSigned\",\n    value: function () {\n      var _isMessageHashSigned = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(messageHash) {\n        var signature,\n          checks,\n          _i,\n          _checks,\n          check,\n          isValid,\n          _args7 = arguments;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                signature = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : '0x';\n                checks = [this.check1271Signature.bind(this), this.check1271SignatureBytes.bind(this)];\n                _i = 0, _checks = checks;\n              case 3:\n                if (!(_i < _checks.length)) {\n                  _context7.next = 13;\n                  break;\n                }\n                check = _checks[_i];\n                _context7.next = 7;\n                return check(messageHash, signature);\n              case 7:\n                isValid = _context7.sent;\n                if (!isValid) {\n                  _context7.next = 10;\n                  break;\n                }\n                return _context7.abrupt(\"return\", true);\n              case 10:\n                _i++;\n                _context7.next = 3;\n                break;\n              case 13:\n                return _context7.abrupt(\"return\", false);\n              case 14:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n      function isMessageHashSigned(_x4) {\n        return _isMessageHashSigned.apply(this, arguments);\n      }\n      return isMessageHashSigned;\n    }()\n  }, {\n    key: \"getEnvironmentInfo\",\n    value: function () {\n      var _getEnvironmentInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.next = 2;\n                return this.communicator.send(methods_1.Methods.getEnvironmentInfo, undefined);\n              case 2:\n                response = _context8.sent;\n                return _context8.abrupt(\"return\", response.data);\n              case 4:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n      function getEnvironmentInfo() {\n        return _getEnvironmentInfo.apply(this, arguments);\n      }\n      return getEnvironmentInfo;\n    }()\n  }, {\n    key: \"requestAddressBook\",\n    value: function () {\n      var _requestAddressBook = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                _context9.next = 2;\n                return this.communicator.send(methods_1.Methods.requestAddressBook, undefined);\n              case 2:\n                response = _context9.sent;\n                return _context9.abrupt(\"return\", response.data);\n              case 4:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n      function requestAddressBook() {\n        return _requestAddressBook.apply(this, arguments);\n      }\n      return requestAddressBook;\n    }()\n  }]);\n  return Safe;\n}();\n__decorate([(0, requirePermissions_1.default)()], Safe.prototype, \"requestAddressBook\", null);\nexports.Safe = Safe;","map":{"version":3,"sources":["../../../src/safe/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Safe = void 0;\nconst ethers_1 = require(\"ethers\");\nconst signatures_1 = require(\"./signatures\");\nconst methods_1 = require(\"../communication/methods\");\nconst constants_1 = require(\"../eth/constants\");\nconst requirePermissions_1 = __importDefault(require(\"../decorators/requirePermissions\"));\nclass Safe {\n    constructor(communicator) {\n        this.communicator = communicator;\n    }\n    async getChainInfo() {\n        const response = await this.communicator.send(methods_1.Methods.getChainInfo, undefined);\n        return response.data;\n    }\n    async getInfo() {\n        const response = await this.communicator.send(methods_1.Methods.getSafeInfo, undefined);\n        return response.data;\n    }\n    // There is a possibility that this method will change because we may add pagination to the endpoint\n    async experimental_getBalances({ currency = 'usd' } = {}) {\n        const response = await this.communicator.send(methods_1.Methods.getSafeBalances, {\n            currency,\n        });\n        return response.data;\n    }\n    async check1271Signature(messageHash, signature = '0x') {\n        const safeInfo = await this.getInfo();\n        const encodedIsValidSignatureCall = signatures_1.EIP_1271_INTERFACE.encodeFunctionData('isValidSignature', [\n            messageHash,\n            signature,\n        ]);\n        const payload = {\n            call: constants_1.RPC_CALLS.eth_call,\n            params: [\n                {\n                    to: safeInfo.safeAddress,\n                    data: encodedIsValidSignatureCall,\n                },\n                'latest',\n            ],\n        };\n        try {\n            const response = await this.communicator.send(methods_1.Methods.rpcCall, payload);\n            return response.data.slice(0, 10).toLowerCase() === signatures_1.MAGIC_VALUE;\n        }\n        catch (err) {\n            return false;\n        }\n    }\n    async check1271SignatureBytes(messageHash, signature = '0x') {\n        const safeInfo = await this.getInfo();\n        const msgBytes = ethers_1.ethers.utils.arrayify(messageHash);\n        const encodedIsValidSignatureCall = signatures_1.EIP_1271_BYTES_INTERFACE.encodeFunctionData('isValidSignature', [\n            msgBytes,\n            signature,\n        ]);\n        const payload = {\n            call: constants_1.RPC_CALLS.eth_call,\n            params: [\n                {\n                    to: safeInfo.safeAddress,\n                    data: encodedIsValidSignatureCall,\n                },\n                'latest',\n            ],\n        };\n        try {\n            const response = await this.communicator.send(methods_1.Methods.rpcCall, payload);\n            return response.data.slice(0, 10).toLowerCase() === signatures_1.MAGIC_VALUE_BYTES;\n        }\n        catch (err) {\n            return false;\n        }\n    }\n    calculateMessageHash(message) {\n        return ethers_1.ethers.utils.hashMessage(message);\n    }\n    async isMessageSigned(message, signature = '0x') {\n        const messageHash = this.calculateMessageHash(message);\n        const messageHashSigned = await this.isMessageHashSigned(messageHash, signature);\n        return messageHashSigned;\n    }\n    async isMessageHashSigned(messageHash, signature = '0x') {\n        const checks = [this.check1271Signature.bind(this), this.check1271SignatureBytes.bind(this)];\n        for (const check of checks) {\n            const isValid = await check(messageHash, signature);\n            if (isValid) {\n                return true;\n            }\n        }\n        return false;\n    }\n    async getEnvironmentInfo() {\n        const response = await this.communicator.send(methods_1.Methods.getEnvironmentInfo, undefined);\n        return response.data;\n    }\n    async requestAddressBook() {\n        const response = await this.communicator.send(methods_1.Methods.requestAddressBook, undefined);\n        return response.data;\n    }\n}\n__decorate([\n    (0, requirePermissions_1.default)()\n], Safe.prototype, \"requestAddressBook\", null);\nexports.Safe = Safe;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}