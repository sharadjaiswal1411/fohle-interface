{"ast":null,"code":"import _objectSpread from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{BigNumber}from'@ethersproject/bignumber';import{useSingleCallResult,useSingleContractMultipleData}from'lib/hooks/multicall';import{useMemo}from'react';import{useV3NFTPositionManagerContract}from'./useContract';function useV3PositionsFromTokenIds(tokenIds){var positionManager=useV3NFTPositionManagerContract();var inputs=useMemo(function(){return tokenIds?tokenIds.map(function(tokenId){return[BigNumber.from(tokenId)];}):[];},[tokenIds]);var results=useSingleContractMultipleData(positionManager,'positions',inputs);var loading=useMemo(function(){return results.some(function(_ref){var loading=_ref.loading;return loading;});},[results]);var error=useMemo(function(){return results.some(function(_ref2){var error=_ref2.error;return error;});},[results]);var positions=useMemo(function(){if(!loading&&!error&&tokenIds){return results.map(function(call,i){var tokenId=tokenIds[i];var result=call.result;return{tokenId:tokenId,fee:result.fee,feeGrowthInside0LastX128:result.feeGrowthInside0LastX128,feeGrowthInside1LastX128:result.feeGrowthInside1LastX128,liquidity:result.liquidity,nonce:result.nonce,operator:result.operator,tickLower:result.tickLower,tickUpper:result.tickUpper,token0:result.token0,token1:result.token1,tokensOwed0:result.tokensOwed0,tokensOwed1:result.tokensOwed1};});}return undefined;},[loading,error,results,tokenIds]);return{loading:loading,positions:positions===null||positions===void 0?void 0:positions.map(function(position,i){return _objectSpread(_objectSpread({},position),{},{tokenId:inputs[i][0]});})};}export function useV3PositionFromTokenId(tokenId){var _position$positions;var position=useV3PositionsFromTokenIds(tokenId?[tokenId]:undefined);return{loading:position.loading,position:(_position$positions=position.positions)===null||_position$positions===void 0?void 0:_position$positions[0]};}export function useV3Positions(account){var _balanceResult$;var positionManager=useV3NFTPositionManagerContract();var _useSingleCallResult=useSingleCallResult(positionManager,'balanceOf',[account!==null&&account!==void 0?account:undefined]),balanceLoading=_useSingleCallResult.loading,balanceResult=_useSingleCallResult.result;// we don't expect any account balance to ever exceed the bounds of max safe int\nvar accountBalance=balanceResult===null||balanceResult===void 0?void 0:(_balanceResult$=balanceResult[0])===null||_balanceResult$===void 0?void 0:_balanceResult$.toNumber();var tokenIdsArgs=useMemo(function(){if(accountBalance&&account){var tokenRequests=[];for(var i=0;i<accountBalance;i++){tokenRequests.push([account,i]);}return tokenRequests;}return[];},[account,accountBalance]);var tokenIdResults=useSingleContractMultipleData(positionManager,'tokenOfOwnerByIndex',tokenIdsArgs);var someTokenIdsLoading=useMemo(function(){return tokenIdResults.some(function(_ref3){var loading=_ref3.loading;return loading;});},[tokenIdResults]);var tokenIds=useMemo(function(){if(account){return tokenIdResults.map(function(_ref4){var result=_ref4.result;return result;}).filter(function(result){return!!result;}).map(function(result){return BigNumber.from(result[0]);});}return[];},[account,tokenIdResults]);var _useV3PositionsFromTo=useV3PositionsFromTokenIds(tokenIds),positions=_useV3PositionsFromTo.positions,positionsLoading=_useV3PositionsFromTo.loading;return{loading:someTokenIdsLoading||balanceLoading||positionsLoading,positions:positions};}","map":{"version":3,"names":["BigNumber","useSingleCallResult","useSingleContractMultipleData","useMemo","useV3NFTPositionManagerContract","useV3PositionsFromTokenIds","tokenIds","positionManager","inputs","map","tokenId","from","results","loading","some","error","positions","call","i","result","fee","feeGrowthInside0LastX128","feeGrowthInside1LastX128","liquidity","nonce","operator","tickLower","tickUpper","token0","token1","tokensOwed0","tokensOwed1","undefined","position","useV3PositionFromTokenId","useV3Positions","account","balanceLoading","balanceResult","accountBalance","toNumber","tokenIdsArgs","tokenRequests","push","tokenIdResults","someTokenIdsLoading","filter","positionsLoading"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/hooks/useV3Positions.ts"],"sourcesContent":["import { BigNumber } from '@ethersproject/bignumber'\nimport { CallStateResult, useSingleCallResult, useSingleContractMultipleData } from 'lib/hooks/multicall'\nimport { useMemo } from 'react'\nimport { PositionDetails } from 'types/position'\n\nimport { useV3NFTPositionManagerContract } from './useContract'\n\ninterface UseV3PositionsResults {\n  loading: boolean\n  positions: PositionDetails[] | undefined\n}\n\nfunction useV3PositionsFromTokenIds(tokenIds: BigNumber[] | undefined): UseV3PositionsResults {\n  const positionManager = useV3NFTPositionManagerContract()\n  const inputs = useMemo(() => (tokenIds ? tokenIds.map((tokenId) => [BigNumber.from(tokenId)]) : []), [tokenIds])\n  const results = useSingleContractMultipleData(positionManager, 'positions', inputs)\n\n  const loading = useMemo(() => results.some(({ loading }) => loading), [results])\n  const error = useMemo(() => results.some(({ error }) => error), [results])\n\n  const positions = useMemo(() => {\n    if (!loading && !error && tokenIds) {\n      return results.map((call, i) => {\n        const tokenId = tokenIds[i]\n        const result = call.result as CallStateResult\n        return {\n          tokenId,\n          fee: result.fee,\n          feeGrowthInside0LastX128: result.feeGrowthInside0LastX128,\n          feeGrowthInside1LastX128: result.feeGrowthInside1LastX128,\n          liquidity: result.liquidity,\n          nonce: result.nonce,\n          operator: result.operator,\n          tickLower: result.tickLower,\n          tickUpper: result.tickUpper,\n          token0: result.token0,\n          token1: result.token1,\n          tokensOwed0: result.tokensOwed0,\n          tokensOwed1: result.tokensOwed1,\n        }\n      })\n    }\n    return undefined\n  }, [loading, error, results, tokenIds])\n\n  return {\n    loading,\n    positions: positions?.map((position, i) => ({ ...position, tokenId: inputs[i][0] })),\n  }\n}\n\ninterface UseV3PositionResults {\n  loading: boolean\n  position: PositionDetails | undefined\n}\n\nexport function useV3PositionFromTokenId(tokenId: BigNumber | undefined): UseV3PositionResults {\n  const position = useV3PositionsFromTokenIds(tokenId ? [tokenId] : undefined)\n  return {\n    loading: position.loading,\n    position: position.positions?.[0],\n  }\n}\n\nexport function useV3Positions(account: string | null | undefined): UseV3PositionsResults {\n  const positionManager = useV3NFTPositionManagerContract()\n\n  const { loading: balanceLoading, result: balanceResult } = useSingleCallResult(positionManager, 'balanceOf', [\n    account ?? undefined,\n  ])\n\n  // we don't expect any account balance to ever exceed the bounds of max safe int\n  const accountBalance: number | undefined = balanceResult?.[0]?.toNumber()\n\n  const tokenIdsArgs = useMemo(() => {\n    if (accountBalance && account) {\n      const tokenRequests = []\n      for (let i = 0; i < accountBalance; i++) {\n        tokenRequests.push([account, i])\n      }\n      return tokenRequests\n    }\n    return []\n  }, [account, accountBalance])\n\n  const tokenIdResults = useSingleContractMultipleData(positionManager, 'tokenOfOwnerByIndex', tokenIdsArgs)\n  const someTokenIdsLoading = useMemo(() => tokenIdResults.some(({ loading }) => loading), [tokenIdResults])\n\n  const tokenIds = useMemo(() => {\n    if (account) {\n      return tokenIdResults\n        .map(({ result }) => result)\n        .filter((result): result is CallStateResult => !!result)\n        .map((result) => BigNumber.from(result[0]))\n    }\n    return []\n  }, [account, tokenIdResults])\n\n  const { positions, loading: positionsLoading } = useV3PositionsFromTokenIds(tokenIds)\n\n  return {\n    loading: someTokenIdsLoading || balanceLoading || positionsLoading,\n    positions,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}