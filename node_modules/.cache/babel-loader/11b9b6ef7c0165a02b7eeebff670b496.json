{"ast":null,"code":"import _regeneratorRuntime from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useMemo,useRef}from'react';import{useLazyCandelsticksQuery}from'services/geckoTermial';var configurationData={supported_resolutions:['1','5','15','1H','2H','4H','1D']};export var useDatafeed=function useDatafeed(poolDetail,tokenId){var _useLazyCandelsticksQ=useLazyCandelsticksQuery(),_useLazyCandelsticksQ2=_slicedToArray(_useLazyCandelsticksQ,2),getCandles=_useLazyCandelsticksQ2[0],isLoading=_useLazyCandelsticksQ2[1].isLoading;var intervalRef=useRef();useEffect(function(){return function(){if(intervalRef.current){clearInterval(intervalRef.current);}};},[]);var base=poolDetail.included[0].id===tokenId?poolDetail.included[0].attributes.symbol:poolDetail.included[1].attributes.symbol;var quote=poolDetail.included[0].id!==tokenId?poolDetail.included[0].attributes.symbol:poolDetail.included[1].attributes.symbol;var label=\"\".concat(base,\"/\").concat(quote);return useMemo(function(){return{onReady:function onReady(callback){setTimeout(function(){return callback(configurationData);});},resolveSymbol:function(){var _resolveSymbol=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_symbolName,onSymbolResolvedCallback,_onResolveErrorCallback){var symbolInfo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:try{symbolInfo={ticker:label,name:label,full_name:label,listed_exchange:'',format:'price',description:label,type:'crypto',session:'24x7',timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,exchange:'',minmov:1,pricescale:10000,has_intraday:true,has_empty_bars:true,has_weekly_and_monthly:true,has_daily:true,supported_resolutions:configurationData.supported_resolutions,data_status:'streaming'};onSymbolResolvedCallback(symbolInfo);}catch(error){console.log(error);}case 1:case\"end\":return _context.stop();}}},_callee);}));function resolveSymbol(_x,_x2,_x3){return _resolveSymbol.apply(this,arguments);}return resolveSymbol;}(),getBars:function(){var _getBars=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_symbolInfo,resolution,periodParams,onHistoryCallback,_onErrorCallback){var _data$data,_data$data2,_data$data2$meta;var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!isLoading){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:_context2.next=4;return getCandles({token_id:tokenId,pool_id:poolDetail.data.id,from:periodParams.from,to:periodParams.to,resolution:resolution,count_back:periodParams.countBack,for_update:false,currency:'token'});case 4:data=_context2.sent;onHistoryCallback((data===null||data===void 0?void 0:(_data$data=data.data)===null||_data$data===void 0?void 0:_data$data.data.map(function(item){return{time:new Date(item.dt).getTime(),open:item.o,high:item.h,close:item.c,low:item.l,volume:item.v};}))||[],{noData:(data===null||data===void 0?void 0:(_data$data2=data.data)===null||_data$data2===void 0?void 0:(_data$data2$meta=_data$data2.meta)===null||_data$data2$meta===void 0?void 0:_data$data2$meta.noData)===true});case 6:case\"end\":return _context2.stop();}}},_callee2);}));function getBars(_x4,_x5,_x6,_x7,_x8){return _getBars.apply(this,arguments);}return getBars;}(),searchSymbols:function searchSymbols(){// TODO(viet-nv): check no empty function rule\n},subscribeBars:function(){var _subscribeBars=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(_symbolInfo,resolution,onTick,_listenerGuid,_onResetCacheNeededCallback){var getData;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _data$data3;var data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getCandles({token_id:tokenId,pool_id:poolDetail.data.id,from:Math.floor(Date.now()/1000)-+resolution*60,to:Math.floor(Date.now()/1000),resolution:resolution,for_update:true,currency:'token'});case 2:data=_context3.sent;onTick(((data===null||data===void 0?void 0:(_data$data3=data.data)===null||_data$data3===void 0?void 0:_data$data3.data)||[]).map(function(item){return{time:new Date(item.dt).getTime(),open:item.o,high:item.h,close:item.c,low:item.l,volume:item.v};})[0]);case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function getData(){return _ref.apply(this,arguments);};}();if(intervalRef.current)clearInterval(intervalRef.current);intervalRef.current=setInterval(getData,30000);getData();case 4:case\"end\":return _context4.stop();}}},_callee4);}));function subscribeBars(_x9,_x10,_x11,_x12,_x13){return _subscribeBars.apply(this,arguments);}return subscribeBars;}(),unsubscribeBars:function unsubscribeBars(){//\n}};},[getCandles,isLoading,poolDetail.data.id,label,tokenId]);};","map":{"version":3,"names":["useEffect","useMemo","useRef","useLazyCandelsticksQuery","configurationData","supported_resolutions","useDatafeed","poolDetail","tokenId","getCandles","isLoading","intervalRef","current","clearInterval","base","included","id","attributes","symbol","quote","label","onReady","callback","setTimeout","resolveSymbol","_symbolName","onSymbolResolvedCallback","_onResolveErrorCallback","symbolInfo","ticker","name","full_name","listed_exchange","format","description","type","session","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","exchange","minmov","pricescale","has_intraday","has_empty_bars","has_weekly_and_monthly","has_daily","data_status","error","console","log","getBars","_symbolInfo","resolution","periodParams","onHistoryCallback","_onErrorCallback","token_id","pool_id","data","from","to","count_back","countBack","for_update","currency","map","item","time","Date","dt","getTime","open","o","high","h","close","c","low","l","volume","v","noData","meta","searchSymbols","subscribeBars","onTick","_listenerGuid","_onResetCacheNeededCallback","getData","Math","floor","now","setInterval","unsubscribeBars"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/components/TradingViewChart/datafeed.tsx"],"sourcesContent":["import { useEffect, useMemo, useRef } from 'react'\nimport { PoolResponse, useLazyCandelsticksQuery } from 'services/geckoTermial'\n\nimport {\n  ErrorCallback,\n  HistoryCallback,\n  LibrarySymbolInfo,\n  PeriodParams,\n  ResolutionString,\n  ResolveCallback,\n  SubscribeBarsCallback,\n  Timezone,\n} from './charting_library'\n\nconst configurationData = {\n  supported_resolutions: ['1', '5', '15', '1H', '2H', '4H', '1D'],\n}\n\nexport const useDatafeed = (poolDetail: PoolResponse, tokenId: string) => {\n  const [getCandles, { isLoading }] = useLazyCandelsticksQuery()\n\n  const intervalRef = useRef<any>()\n\n  useEffect(() => {\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current)\n      }\n    }\n  }, [])\n\n  const base =\n    poolDetail.included[0].id === tokenId\n      ? poolDetail.included[0].attributes.symbol\n      : poolDetail.included[1].attributes.symbol\n  const quote =\n    poolDetail.included[0].id !== tokenId\n      ? poolDetail.included[0].attributes.symbol\n      : poolDetail.included[1].attributes.symbol\n\n  const label = `${base}/${quote}`\n\n  return useMemo(() => {\n    return {\n      onReady: (callback: any) => {\n        setTimeout(() => callback(configurationData))\n      },\n      resolveSymbol: async (\n        _symbolName: string,\n        onSymbolResolvedCallback: ResolveCallback,\n        _onResolveErrorCallback: ErrorCallback,\n      ) => {\n        try {\n          const symbolInfo: LibrarySymbolInfo = {\n            ticker: label,\n            name: label,\n            full_name: label,\n            listed_exchange: '',\n            format: 'price',\n            description: label,\n            type: 'crypto',\n            session: '24x7',\n            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone as Timezone,\n            exchange: '',\n            minmov: 1,\n            pricescale: 10000,\n            has_intraday: true,\n            has_empty_bars: true,\n            has_weekly_and_monthly: true,\n            has_daily: true,\n            supported_resolutions: configurationData.supported_resolutions as ResolutionString[],\n            data_status: 'streaming',\n          }\n          onSymbolResolvedCallback(symbolInfo)\n        } catch (error) {\n          console.log(error)\n        }\n      },\n      getBars: async (\n        // symbolInfo is not used\n        _symbolInfo: LibrarySymbolInfo,\n        resolution: ResolutionString,\n        periodParams: PeriodParams,\n        onHistoryCallback: HistoryCallback,\n        _onErrorCallback: ErrorCallback,\n      ) => {\n        if (isLoading) return\n\n        const data = await getCandles({\n          token_id: tokenId,\n          pool_id: poolDetail.data.id,\n          from: periodParams.from,\n          to: periodParams.to,\n          resolution,\n          count_back: periodParams.countBack,\n          for_update: false,\n          currency: 'token',\n        })\n\n        onHistoryCallback(\n          data?.data?.data.map((item: any) => ({\n            time: new Date(item.dt).getTime(),\n            open: item.o,\n            high: item.h,\n            close: item.c,\n            low: item.l,\n            volume: item.v,\n          })) || [],\n          {\n            noData: data?.data?.meta?.noData === true,\n          },\n        )\n      },\n      searchSymbols: () => {\n        // TODO(viet-nv): check no empty function rule\n      },\n      subscribeBars: async (\n        _symbolInfo: LibrarySymbolInfo,\n        resolution: ResolutionString,\n        onTick: SubscribeBarsCallback,\n        _listenerGuid: string,\n        _onResetCacheNeededCallback: () => void,\n      ) => {\n        const getData = async () => {\n          const data = await getCandles({\n            token_id: tokenId,\n            pool_id: poolDetail.data.id,\n            from: Math.floor(Date.now() / 1000) - +resolution * 60,\n            to: Math.floor(Date.now() / 1000),\n            resolution,\n            for_update: true,\n            currency: 'token',\n          })\n\n          onTick(\n            (data?.data?.data || []).map((item: any) => ({\n              time: new Date(item.dt).getTime(),\n              open: item.o,\n              high: item.h,\n              close: item.c,\n              low: item.l,\n              volume: item.v,\n            }))[0],\n          )\n        }\n        if (intervalRef.current) clearInterval(intervalRef.current)\n        intervalRef.current = setInterval(getData, 30000)\n        getData()\n      },\n      unsubscribeBars: () => {\n        //\n      },\n    }\n  }, [getCandles, isLoading, poolDetail.data.id, label, tokenId])\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}