{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar image_1 = require(\"@vibrant/image\");\nfunction isRelativeUrl(url) {\n  var u = new URL(url, location.href);\n  return u.protocol === location.protocol && u.host === location.host && u.port === location.port;\n}\nfunction isSameOrigin(a, b) {\n  var ua = new URL(a);\n  var ub = new URL(b);\n  // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n  return ua.protocol === ub.protocol && ua.hostname === ub.hostname && ua.port === ub.port;\n}\nvar BrowserImage = /** @class */function (_super) {\n  __extends(BrowserImage, _super);\n  function BrowserImage() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  BrowserImage.prototype._initCanvas = function () {\n    var img = this.image;\n    var canvas = this._canvas = document.createElement('canvas');\n    var context = canvas.getContext('2d');\n    if (!context) throw new ReferenceError('Failed to create canvas context');\n    this._context = context;\n    canvas.className = '@vibrant/canvas';\n    canvas.style.display = 'none';\n    this._width = canvas.width = img.width;\n    this._height = canvas.height = img.height;\n    context.drawImage(img, 0, 0);\n    document.body.appendChild(canvas);\n  };\n  BrowserImage.prototype.load = function (image) {\n    var _this = this;\n    var img;\n    var src;\n    if (typeof image === 'string') {\n      img = document.createElement('img');\n      src = image;\n      if (!isRelativeUrl(src) && !isSameOrigin(window.location.href, src)) {\n        img.crossOrigin = 'anonymous';\n      }\n      img.src = src;\n    } else if (image instanceof HTMLImageElement) {\n      img = image;\n      src = image.src;\n    } else {\n      return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n    }\n    this.image = img;\n    return new Promise(function (resolve, reject) {\n      var onImageLoad = function () {\n        _this._initCanvas();\n        resolve(_this);\n      };\n      if (img.complete) {\n        // Already loaded\n        onImageLoad();\n      } else {\n        img.onload = onImageLoad;\n        img.onerror = function (e) {\n          return reject(new Error(\"Fail to load image: \" + src));\n        };\n      }\n    });\n  };\n  BrowserImage.prototype.clear = function () {\n    this._context.clearRect(0, 0, this._width, this._height);\n  };\n  BrowserImage.prototype.update = function (imageData) {\n    this._context.putImageData(imageData, 0, 0);\n  };\n  BrowserImage.prototype.getWidth = function () {\n    return this._width;\n  };\n  BrowserImage.prototype.getHeight = function () {\n    return this._height;\n  };\n  BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n    var _a = this,\n      canvas = _a._canvas,\n      context = _a._context,\n      img = _a.image;\n    this._width = canvas.width = targetWidth;\n    this._height = canvas.height = targetHeight;\n    context.scale(ratio, ratio);\n    context.drawImage(img, 0, 0);\n  };\n  BrowserImage.prototype.getPixelCount = function () {\n    return this._width * this._height;\n  };\n  BrowserImage.prototype.getImageData = function () {\n    return this._context.getImageData(0, 0, this._width, this._height);\n  };\n  BrowserImage.prototype.remove = function () {\n    if (this._canvas && this._canvas.parentNode) {\n      this._canvas.parentNode.removeChild(this._canvas);\n    }\n  };\n  return BrowserImage;\n}(image_1.ImageBase);\nexports.default = BrowserImage;","map":{"version":3,"sources":["../../../../packages/vibrant-image-browser/src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar image_1 = require(\"@vibrant/image\");\nfunction isRelativeUrl(url) {\n    var u = new URL(url, location.href);\n    return u.protocol === location.protocol &&\n        u.host === location.host &&\n        u.port === location.port;\n}\nfunction isSameOrigin(a, b) {\n    var ua = new URL(a);\n    var ub = new URL(b);\n    // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n    return (ua.protocol === ub.protocol &&\n        ua.hostname === ub.hostname &&\n        ua.port === ub.port);\n}\nvar BrowserImage = /** @class */ (function (_super) {\n    __extends(BrowserImage, _super);\n    function BrowserImage() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BrowserImage.prototype._initCanvas = function () {\n        var img = this.image;\n        var canvas = (this._canvas = document.createElement('canvas'));\n        var context = (canvas.getContext('2d'));\n        if (!context)\n            throw new ReferenceError('Failed to create canvas context');\n        this._context = context;\n        canvas.className = '@vibrant/canvas';\n        canvas.style.display = 'none';\n        this._width = canvas.width = img.width;\n        this._height = canvas.height = img.height;\n        context.drawImage(img, 0, 0);\n        document.body.appendChild(canvas);\n    };\n    BrowserImage.prototype.load = function (image) {\n        var _this = this;\n        var img;\n        var src;\n        if (typeof image === 'string') {\n            img = document.createElement('img');\n            src = image;\n            if (!isRelativeUrl(src) && !isSameOrigin(window.location.href, src)) {\n                img.crossOrigin = 'anonymous';\n            }\n            img.src = src;\n        }\n        else if (image instanceof HTMLImageElement) {\n            img = image;\n            src = image.src;\n        }\n        else {\n            return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n        }\n        this.image = img;\n        return new Promise(function (resolve, reject) {\n            var onImageLoad = function () {\n                _this._initCanvas();\n                resolve(_this);\n            };\n            if (img.complete) {\n                // Already loaded\n                onImageLoad();\n            }\n            else {\n                img.onload = onImageLoad;\n                img.onerror = function (e) { return reject(new Error(\"Fail to load image: \" + src)); };\n            }\n        });\n    };\n    BrowserImage.prototype.clear = function () {\n        this._context.clearRect(0, 0, this._width, this._height);\n    };\n    BrowserImage.prototype.update = function (imageData) {\n        this._context.putImageData(imageData, 0, 0);\n    };\n    BrowserImage.prototype.getWidth = function () {\n        return this._width;\n    };\n    BrowserImage.prototype.getHeight = function () {\n        return this._height;\n    };\n    BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n        var _a = this, canvas = _a._canvas, context = _a._context, img = _a.image;\n        this._width = canvas.width = targetWidth;\n        this._height = canvas.height = targetHeight;\n        context.scale(ratio, ratio);\n        context.drawImage(img, 0, 0);\n    };\n    BrowserImage.prototype.getPixelCount = function () {\n        return this._width * this._height;\n    };\n    BrowserImage.prototype.getImageData = function () {\n        return this._context.getImageData(0, 0, this._width, this._height);\n    };\n    BrowserImage.prototype.remove = function () {\n        if (this._canvas && this._canvas.parentNode) {\n            this._canvas.parentNode.removeChild(this._canvas);\n        }\n    };\n    return BrowserImage;\n}(image_1.ImageBase));\nexports.default = BrowserImage;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}