{"ast":null,"code":"\"use strict\";\n\nvar _createClass = require(\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\nvar _classCallCheck = require(\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __exportStar = this && this.__exportStar || function (m, exports) {\n  for (var p in m) {\n    if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar messageFormatter_1 = require(\"./messageFormatter\");\nvar PostMessageCommunicator = /*#__PURE__*/_createClass(function PostMessageCommunicator() {\n  var _this = this;\n  var allowedOrigins = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  var debugMode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  _classCallCheck(this, PostMessageCommunicator);\n  this.allowedOrigins = null;\n  this.callbacks = new Map();\n  this.debugMode = false;\n  this.isServer = typeof window === 'undefined';\n  this.isValidMessage = function (_ref) {\n    var origin = _ref.origin,\n      data = _ref.data,\n      source = _ref.source;\n    var emptyOrMalformed = !data;\n    var sentFromParentEl = !_this.isServer && source === window.parent;\n    var majorVersionNumber = typeof data.version !== 'undefined' && parseInt(data.version.split('.')[0]);\n    var allowedSDKVersion = majorVersionNumber >= 1;\n    var validOrigin = true;\n    if (Array.isArray(_this.allowedOrigins)) {\n      validOrigin = _this.allowedOrigins.find(function (regExp) {\n        return regExp.test(origin);\n      }) !== undefined;\n    }\n    return !emptyOrMalformed && sentFromParentEl && allowedSDKVersion && validOrigin;\n  };\n  this.logIncomingMessage = function (msg) {\n    console.info(\"Safe Apps SDK v1: A message was received from origin \".concat(msg.origin, \". \"), msg.data);\n  };\n  this.onParentMessage = function (msg) {\n    if (_this.isValidMessage(msg)) {\n      _this.debugMode && _this.logIncomingMessage(msg);\n      _this.handleIncomingMessage(msg.data);\n    }\n  };\n  this.handleIncomingMessage = function (payload) {\n    var id = payload.id;\n    var cb = _this.callbacks.get(id);\n    if (cb) {\n      cb(payload);\n      _this.callbacks.delete(id);\n    }\n  };\n  this.send = function (method, params) {\n    var request = messageFormatter_1.MessageFormatter.makeRequest(method, params);\n    if (_this.isServer) {\n      throw new Error(\"Window doesn't exist\");\n    }\n    window.parent.postMessage(request, '*');\n    return new Promise(function (resolve, reject) {\n      _this.callbacks.set(request.id, function (response) {\n        if (!response.success) {\n          reject(new Error(response.error));\n          return;\n        }\n        resolve(response);\n      });\n    });\n  };\n  this.allowedOrigins = allowedOrigins;\n  this.debugMode = debugMode;\n  if (!this.isServer) {\n    window.addEventListener('message', this.onParentMessage);\n  }\n});\nexports.default = PostMessageCommunicator;\n__exportStar(require(\"./methods\"), exports);","map":{"version":3,"sources":["../../../src/communication/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst messageFormatter_1 = require(\"./messageFormatter\");\nclass PostMessageCommunicator {\n    constructor(allowedOrigins = null, debugMode = false) {\n        this.allowedOrigins = null;\n        this.callbacks = new Map();\n        this.debugMode = false;\n        this.isServer = typeof window === 'undefined';\n        this.isValidMessage = ({ origin, data, source }) => {\n            const emptyOrMalformed = !data;\n            const sentFromParentEl = !this.isServer && source === window.parent;\n            const majorVersionNumber = typeof data.version !== 'undefined' && parseInt(data.version.split('.')[0]);\n            const allowedSDKVersion = majorVersionNumber >= 1;\n            let validOrigin = true;\n            if (Array.isArray(this.allowedOrigins)) {\n                validOrigin = this.allowedOrigins.find((regExp) => regExp.test(origin)) !== undefined;\n            }\n            return !emptyOrMalformed && sentFromParentEl && allowedSDKVersion && validOrigin;\n        };\n        this.logIncomingMessage = (msg) => {\n            console.info(`Safe Apps SDK v1: A message was received from origin ${msg.origin}. `, msg.data);\n        };\n        this.onParentMessage = (msg) => {\n            if (this.isValidMessage(msg)) {\n                this.debugMode && this.logIncomingMessage(msg);\n                this.handleIncomingMessage(msg.data);\n            }\n        };\n        this.handleIncomingMessage = (payload) => {\n            const { id } = payload;\n            const cb = this.callbacks.get(id);\n            if (cb) {\n                cb(payload);\n                this.callbacks.delete(id);\n            }\n        };\n        this.send = (method, params) => {\n            const request = messageFormatter_1.MessageFormatter.makeRequest(method, params);\n            if (this.isServer) {\n                throw new Error(\"Window doesn't exist\");\n            }\n            window.parent.postMessage(request, '*');\n            return new Promise((resolve, reject) => {\n                this.callbacks.set(request.id, (response) => {\n                    if (!response.success) {\n                        reject(new Error(response.error));\n                        return;\n                    }\n                    resolve(response);\n                });\n            });\n        };\n        this.allowedOrigins = allowedOrigins;\n        this.debugMode = debugMode;\n        if (!this.isServer) {\n            window.addEventListener('message', this.onParentMessage);\n        }\n    }\n}\nexports.default = PostMessageCommunicator;\n__exportStar(require(\"./methods\"), exports);\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}