{"ast":null,"code":"import _objectSpread from\"/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{isPooledMarket,Markets}from'nft/types';import{calcAvgGroupPoolPrice,formatWeiToDecimal,isInSameMarketplaceCollection,isInSameSudoSwapPool}from'nft/utils';var isTheSame=function isTheSame(item,routeAsset){// if route asset has id, match by id\nif('id'in routeAsset&&routeAsset.id){return routeAsset.id===item.id;}else{return'address'in routeAsset&&routeAsset.address.toLowerCase()===item.address.toLowerCase()&&routeAsset.tokenId===item.tokenId;}};var isPriceDiff=function isPriceDiff(oldPrice,newPrice){return formatWeiToDecimal(oldPrice)!==formatWeiToDecimal(newPrice);};var isAveragePriceOfPooledAssets=function isAveragePriceOfPooledAssets(asset,numberOfAssetsInPool,expectedPrice){return!isPriceDiff(calcAvgGroupPoolPrice(asset,numberOfAssetsInPool),expectedPrice);};var isAveragedPrice=function isAveragedPrice(item,items,route,txRoute){if(!(route&&'priceInfo'in route.assetOut))return false;return!!item.marketplace&&isPooledMarket(item.marketplace)&&isAveragePriceOfPooledAssets(item,items.filter(function(routeItem){return itemInRouteAndSamePool(item,routeItem,txRoute);}).length,route.assetOut.priceInfo.basePrice);};var getRouteForItem=function getRouteForItem(item,txRoute){return txRoute&&txRoute.find(function(r){return r.action==='Buy'&&isTheSame(item,r.assetOut);});};var itemHasRoute=function itemHasRoute(item,txRoute){return!!getRouteForItem(item,txRoute);};var itemInRouteAndSamePool=function itemInRouteAndSamePool(item,routeItem,txRoute){return itemHasRoute(routeItem,txRoute)&&(item.marketplace===Markets.Sudoswap?isInSameSudoSwapPool(item,routeItem):isInSameMarketplaceCollection(item,routeItem));};export var combineBuyItemsWithTxRoute=function combineBuyItemsWithTxRoute(items,txRoute){return items.map(function(item){var route=getRouteForItem(item,txRoute);// if the item is not found in txRoute, it means it's no longer for sale\nif(txRoute&&!route){return _objectSpread(_objectSpread({},item),{},{isUnavailable:true});}var newPriceInfo=item.updatedPriceInfo?item.updatedPriceInfo:item.priceInfo;// if the price changed\nif(route&&'priceInfo'in route.assetOut){if(isPriceDiff(newPriceInfo.basePrice,route.assetOut.priceInfo.basePrice)){if(!isAveragedPrice(item,items,route,txRoute)){return _objectSpread(_objectSpread({},item),{},{updatedPriceInfo:route.assetOut.priceInfo});}}}return _objectSpread(_objectSpread({},item),{},{priceInfo:newPriceInfo,updatedPriceInfo:undefined,orderSource:route&&'orderSource'in route.assetOut?route.assetOut.orderSource:undefined});});};","map":{"version":3,"names":["isPooledMarket","Markets","calcAvgGroupPoolPrice","formatWeiToDecimal","isInSameMarketplaceCollection","isInSameSudoSwapPool","isTheSame","item","routeAsset","id","address","toLowerCase","tokenId","isPriceDiff","oldPrice","newPrice","isAveragePriceOfPooledAssets","asset","numberOfAssetsInPool","expectedPrice","isAveragedPrice","items","route","txRoute","assetOut","marketplace","filter","routeItem","itemInRouteAndSamePool","length","priceInfo","basePrice","getRouteForItem","find","r","action","itemHasRoute","Sudoswap","combineBuyItemsWithTxRoute","map","isUnavailable","newPriceInfo","updatedPriceInfo","undefined","orderSource"],"sources":["/Applications/XAMPP/xamppfiles/htdocs/fohle-interface/src/nft/utils/txRoute/combineItemsWithTxRoute.ts"],"sourcesContent":["import { BuyItem, GenieAsset, isPooledMarket, Markets, PriceInfo, RoutingItem, UpdatedGenieAsset } from 'nft/types'\nimport {\n  calcAvgGroupPoolPrice,\n  formatWeiToDecimal,\n  isInSameMarketplaceCollection,\n  isInSameSudoSwapPool,\n} from 'nft/utils'\n\nconst isTheSame = (item: GenieAsset, routeAsset: BuyItem | PriceInfo) => {\n  // if route asset has id, match by id\n  if ('id' in routeAsset && routeAsset.id) {\n    return routeAsset.id === item.id\n  } else {\n    return (\n      'address' in routeAsset &&\n      routeAsset.address.toLowerCase() === item.address.toLowerCase() &&\n      routeAsset.tokenId === item.tokenId\n    )\n  }\n}\n\nconst isPriceDiff = (oldPrice: string, newPrice: string) => {\n  return formatWeiToDecimal(oldPrice) !== formatWeiToDecimal(newPrice)\n}\n\nconst isAveragePriceOfPooledAssets = (\n  asset: GenieAsset,\n  numberOfAssetsInPool: number,\n  expectedPrice: string\n): boolean => {\n  return !isPriceDiff(calcAvgGroupPoolPrice(asset, numberOfAssetsInPool), expectedPrice)\n}\n\nconst isAveragedPrice = (\n  item: UpdatedGenieAsset,\n  items: UpdatedGenieAsset[],\n  route: RoutingItem,\n  txRoute?: RoutingItem[]\n): boolean => {\n  if (!(route && 'priceInfo' in route.assetOut)) return false\n\n  return (\n    !!item.marketplace &&\n    isPooledMarket(item.marketplace) &&\n    isAveragePriceOfPooledAssets(\n      item,\n      items.filter((routeItem) => itemInRouteAndSamePool(item, routeItem, txRoute)).length,\n      route.assetOut.priceInfo.basePrice\n    )\n  )\n}\n\nconst getRouteForItem = (item: UpdatedGenieAsset, txRoute?: RoutingItem[]): RoutingItem | undefined => {\n  return txRoute && txRoute.find((r) => r.action === 'Buy' && isTheSame(item, r.assetOut))\n}\n\nconst itemHasRoute = (item: UpdatedGenieAsset, txRoute?: RoutingItem[]): boolean => {\n  return !!getRouteForItem(item, txRoute)\n}\n\nconst itemInRouteAndSamePool = (\n  item: UpdatedGenieAsset,\n  routeItem: UpdatedGenieAsset,\n  txRoute?: RoutingItem[]\n): boolean => {\n  return (\n    itemHasRoute(routeItem, txRoute) &&\n    (item.marketplace === Markets.Sudoswap\n      ? isInSameSudoSwapPool(item, routeItem)\n      : isInSameMarketplaceCollection(item, routeItem))\n  )\n}\n\nexport const combineBuyItemsWithTxRoute = (\n  items: UpdatedGenieAsset[],\n  txRoute?: RoutingItem[]\n): UpdatedGenieAsset[] => {\n  return items.map((item) => {\n    const route = getRouteForItem(item, txRoute)\n\n    // if the item is not found in txRoute, it means it's no longer for sale\n    if (txRoute && !route) {\n      return {\n        ...item,\n        isUnavailable: true,\n      }\n    }\n\n    const newPriceInfo = item.updatedPriceInfo ? item.updatedPriceInfo : item.priceInfo\n\n    // if the price changed\n    if (route && 'priceInfo' in route.assetOut) {\n      if (isPriceDiff(newPriceInfo.basePrice, route.assetOut.priceInfo.basePrice)) {\n        if (!isAveragedPrice(item, items, route, txRoute)) {\n          return {\n            ...item,\n            updatedPriceInfo: route.assetOut.priceInfo,\n          }\n        }\n      }\n    }\n\n    return {\n      ...item,\n      priceInfo: newPriceInfo,\n      updatedPriceInfo: undefined,\n      orderSource: route && 'orderSource' in route.assetOut ? route.assetOut.orderSource : undefined,\n    }\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}