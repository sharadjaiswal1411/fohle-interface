{"ast":null,"code":"import { Token } from '@uniswap/sdk-core';\nimport _ from 'lodash';\nimport { ChainId, log, WRAPPED_NATIVE_CURRENCY } from '../util';\nimport { CELO, CELO_ALFAJORES, CEUR_CELO, CUSD_CELO, CUSD_CELO_ALFAJORES, DAI_ARBITRUM, DAI_ARBITRUM_RINKEBY, DAI_CELO, DAI_CELO_ALFAJORES, DAI_MAINNET, DAI_MOONBEAM, DAI_OPTIMISM, DAI_OPTIMISTIC_KOVAN, DAI_POLYGON_MUMBAI, DAI_RINKEBY_1, DAI_RINKEBY_2, UNI_ARBITRUM_RINKEBY, USDC_ARBITRUM, USDC_ARBITRUM_RINKEBY, USDC_ETHEREUM_GNOSIS, USDC_MAINNET, USDC_MOONBEAM, USDC_OPTIMISM, USDC_OPTIMISTIC_KOVAN, USDC_POLYGON, USDT_ARBITRUM, USDT_ARBITRUM_RINKEBY, USDT_MAINNET, USDT_OPTIMISM, USDT_OPTIMISTIC_KOVAN, WBTC_ARBITRUM, WBTC_MAINNET, WBTC_MOONBEAM, WBTC_OPTIMISM, WBTC_OPTIMISTIC_KOVAN, WMATIC_POLYGON, WMATIC_POLYGON_MUMBAI } from './token-provider';\n// These tokens will added to the Token cache on initialization.\nexport const CACHE_SEED_TOKENS = {\n  [ChainId.MAINNET]: {\n    WETH: WRAPPED_NATIVE_CURRENCY[ChainId.MAINNET],\n    USDC: USDC_MAINNET,\n    USDT: USDT_MAINNET,\n    WBTC: WBTC_MAINNET,\n    DAI: DAI_MAINNET,\n    // This token stores its symbol as bytes32, therefore can not be fetched on-chain using\n    // our token providers.\n    // This workaround adds it to the cache, so we won't try to fetch it on-chain.\n    RING: new Token(ChainId.MAINNET, '0x9469D013805bFfB7D3DEBe5E7839237e535ec483', 18, 'RING', 'RING')\n  },\n  [ChainId.RINKEBY]: {\n    WETH: WRAPPED_NATIVE_CURRENCY[ChainId.RINKEBY],\n    DAI_1: DAI_RINKEBY_1,\n    DAI_2: DAI_RINKEBY_2\n  },\n  [ChainId.OPTIMISM]: {\n    USDC: USDC_OPTIMISM,\n    USDT: USDT_OPTIMISM,\n    WBTC: WBTC_OPTIMISM,\n    DAI: DAI_OPTIMISM\n  },\n  [ChainId.OPTIMISTIC_KOVAN]: {\n    USDC: USDC_OPTIMISTIC_KOVAN,\n    USDT: USDT_OPTIMISTIC_KOVAN,\n    WBTC: WBTC_OPTIMISTIC_KOVAN,\n    DAI: DAI_OPTIMISTIC_KOVAN\n  },\n  [ChainId.ARBITRUM_ONE]: {\n    USDC: USDC_ARBITRUM,\n    USDT: USDT_ARBITRUM,\n    WBTC: WBTC_ARBITRUM,\n    DAI: DAI_ARBITRUM\n  },\n  [ChainId.ARBITRUM_RINKEBY]: {\n    USDT: USDT_ARBITRUM_RINKEBY,\n    UNI: UNI_ARBITRUM_RINKEBY,\n    DAI: DAI_ARBITRUM_RINKEBY,\n    USDC: USDC_ARBITRUM_RINKEBY\n  },\n  [ChainId.POLYGON]: {\n    WMATIC: WMATIC_POLYGON,\n    USDC: USDC_POLYGON\n  },\n  [ChainId.POLYGON_MUMBAI]: {\n    WMATIC: WMATIC_POLYGON_MUMBAI,\n    DAI: DAI_POLYGON_MUMBAI\n  },\n  [ChainId.CELO]: {\n    CELO: CELO,\n    CUSD: CUSD_CELO,\n    CEUR: CEUR_CELO,\n    DAI: DAI_CELO\n  },\n  [ChainId.CELO_ALFAJORES]: {\n    CELO: CELO_ALFAJORES,\n    CUSD: CUSD_CELO_ALFAJORES,\n    CEUR: CUSD_CELO_ALFAJORES,\n    DAI: DAI_CELO_ALFAJORES\n  },\n  [ChainId.GNOSIS]: {\n    WXDAI: WRAPPED_NATIVE_CURRENCY[ChainId.GNOSIS],\n    USDC_ETHEREUM_GNOSIS: USDC_ETHEREUM_GNOSIS\n  },\n  [ChainId.MOONBEAM]: {\n    USDC: USDC_MOONBEAM,\n    DAI: DAI_MOONBEAM,\n    WBTC: WBTC_MOONBEAM,\n    WGLMR: WRAPPED_NATIVE_CURRENCY[ChainId.MOONBEAM]\n  }\n  // Currently we do not have providers for Moonbeam mainnet or Gnosis testnet\n};\n/**\n * Provider for getting token metadata that falls back to a different provider\n * in the event of failure.\n *\n * @export\n * @class CachingTokenProviderWithFallback\n */\nexport class CachingTokenProviderWithFallback {\n  constructor(chainId,\n  // Token metadata (e.g. symbol and decimals) don't change so can be cached indefinitely.\n  // Constructing a new token object is slow as sdk-core does checksumming.\n  tokenCache, primaryTokenProvider, fallbackTokenProvider) {\n    this.chainId = chainId;\n    this.tokenCache = tokenCache;\n    this.primaryTokenProvider = primaryTokenProvider;\n    this.fallbackTokenProvider = fallbackTokenProvider;\n    this.CACHE_KEY = (chainId, address) => `token-${chainId}-${address}`;\n  }\n  async getTokens(_addresses) {\n    const seedTokens = CACHE_SEED_TOKENS[this.chainId];\n    if (seedTokens) {\n      for (const token of Object.values(seedTokens)) {\n        await this.tokenCache.set(this.CACHE_KEY(this.chainId, token.address.toLowerCase()), token);\n      }\n    }\n    const addressToToken = {};\n    const symbolToToken = {};\n    const addresses = _(_addresses).map(address => address.toLowerCase()).uniq().value();\n    const addressesToFindInPrimary = [];\n    const addressesToFindInSecondary = [];\n    for (const address of addresses) {\n      if (await this.tokenCache.has(this.CACHE_KEY(this.chainId, address))) {\n        addressToToken[address.toLowerCase()] = await this.tokenCache.get(this.CACHE_KEY(this.chainId, address));\n        symbolToToken[addressToToken[address].symbol] = await this.tokenCache.get(this.CACHE_KEY(this.chainId, address));\n      } else {\n        addressesToFindInPrimary.push(address);\n      }\n    }\n    log.info({\n      addressesToFindInPrimary\n    }, `Found ${addresses.length - addressesToFindInPrimary.length} out of ${addresses.length} tokens in local cache. ${addressesToFindInPrimary.length > 0 ? `Checking primary token provider for ${addressesToFindInPrimary.length} tokens` : ``}\n      `);\n    if (addressesToFindInPrimary.length > 0) {\n      const primaryTokenAccessor = await this.primaryTokenProvider.getTokens(addressesToFindInPrimary);\n      for (const address of addressesToFindInPrimary) {\n        const token = primaryTokenAccessor.getTokenByAddress(address);\n        if (token) {\n          addressToToken[address.toLowerCase()] = token;\n          symbolToToken[addressToToken[address].symbol] = token;\n          await this.tokenCache.set(this.CACHE_KEY(this.chainId, address.toLowerCase()), addressToToken[address]);\n        } else {\n          addressesToFindInSecondary.push(address);\n        }\n      }\n      log.info({\n        addressesToFindInSecondary\n      }, `Found ${addressesToFindInPrimary.length - addressesToFindInSecondary.length} tokens in primary. ${this.fallbackTokenProvider ? `Checking secondary token provider for ${addressesToFindInSecondary.length} tokens` : `No fallback token provider specified. About to return.`}`);\n    }\n    if (this.fallbackTokenProvider && addressesToFindInSecondary.length > 0) {\n      const secondaryTokenAccessor = await this.fallbackTokenProvider.getTokens(addressesToFindInSecondary);\n      for (const address of addressesToFindInSecondary) {\n        const token = secondaryTokenAccessor.getTokenByAddress(address);\n        if (token) {\n          addressToToken[address.toLowerCase()] = token;\n          symbolToToken[addressToToken[address].symbol] = token;\n          await this.tokenCache.set(this.CACHE_KEY(this.chainId, address.toLowerCase()), addressToToken[address]);\n        }\n      }\n    }\n    return {\n      getTokenByAddress: address => {\n        return addressToToken[address.toLowerCase()];\n      },\n      getTokenBySymbol: symbol => {\n        return symbolToToken[symbol.toLowerCase()];\n      },\n      getAllTokens: () => {\n        return Object.values(addressToToken);\n      }\n    };\n  }\n}","map":{"version":3,"sources":["../../../src/providers/caching-token-provider.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { Token } from '@uniswap/sdk-core';\nimport _ from 'lodash';\nimport { ChainId, log, WRAPPED_NATIVE_CURRENCY } from '../util';\nimport { CELO, CELO_ALFAJORES, CEUR_CELO, CUSD_CELO, CUSD_CELO_ALFAJORES, DAI_ARBITRUM, DAI_ARBITRUM_RINKEBY, DAI_CELO, DAI_CELO_ALFAJORES, DAI_MAINNET, DAI_MOONBEAM, DAI_OPTIMISM, DAI_OPTIMISTIC_KOVAN, DAI_POLYGON_MUMBAI, DAI_RINKEBY_1, DAI_RINKEBY_2, UNI_ARBITRUM_RINKEBY, USDC_ARBITRUM, USDC_ARBITRUM_RINKEBY, USDC_ETHEREUM_GNOSIS, USDC_MAINNET, USDC_MOONBEAM, USDC_OPTIMISM, USDC_OPTIMISTIC_KOVAN, USDC_POLYGON, USDT_ARBITRUM, USDT_ARBITRUM_RINKEBY, USDT_MAINNET, USDT_OPTIMISM, USDT_OPTIMISTIC_KOVAN, WBTC_ARBITRUM, WBTC_MAINNET, WBTC_MOONBEAM, WBTC_OPTIMISM, WBTC_OPTIMISTIC_KOVAN, WMATIC_POLYGON, WMATIC_POLYGON_MUMBAI, } from './token-provider';\n// These tokens will added to the Token cache on initialization.\nexport const CACHE_SEED_TOKENS = {\n    [ChainId.MAINNET]: {\n        WETH: WRAPPED_NATIVE_CURRENCY[ChainId.MAINNET],\n        USDC: USDC_MAINNET,\n        USDT: USDT_MAINNET,\n        WBTC: WBTC_MAINNET,\n        DAI: DAI_MAINNET,\n        // This token stores its symbol as bytes32, therefore can not be fetched on-chain using\n        // our token providers.\n        // This workaround adds it to the cache, so we won't try to fetch it on-chain.\n        RING: new Token(ChainId.MAINNET, '0x9469D013805bFfB7D3DEBe5E7839237e535ec483', 18, 'RING', 'RING'),\n    },\n    [ChainId.RINKEBY]: {\n        WETH: WRAPPED_NATIVE_CURRENCY[ChainId.RINKEBY],\n        DAI_1: DAI_RINKEBY_1,\n        DAI_2: DAI_RINKEBY_2,\n    },\n    [ChainId.OPTIMISM]: {\n        USDC: USDC_OPTIMISM,\n        USDT: USDT_OPTIMISM,\n        WBTC: WBTC_OPTIMISM,\n        DAI: DAI_OPTIMISM,\n    },\n    [ChainId.OPTIMISTIC_KOVAN]: {\n        USDC: USDC_OPTIMISTIC_KOVAN,\n        USDT: USDT_OPTIMISTIC_KOVAN,\n        WBTC: WBTC_OPTIMISTIC_KOVAN,\n        DAI: DAI_OPTIMISTIC_KOVAN,\n    },\n    [ChainId.ARBITRUM_ONE]: {\n        USDC: USDC_ARBITRUM,\n        USDT: USDT_ARBITRUM,\n        WBTC: WBTC_ARBITRUM,\n        DAI: DAI_ARBITRUM,\n    },\n    [ChainId.ARBITRUM_RINKEBY]: {\n        USDT: USDT_ARBITRUM_RINKEBY,\n        UNI: UNI_ARBITRUM_RINKEBY,\n        DAI: DAI_ARBITRUM_RINKEBY,\n        USDC: USDC_ARBITRUM_RINKEBY,\n    },\n    [ChainId.POLYGON]: {\n        WMATIC: WMATIC_POLYGON,\n        USDC: USDC_POLYGON,\n    },\n    [ChainId.POLYGON_MUMBAI]: {\n        WMATIC: WMATIC_POLYGON_MUMBAI,\n        DAI: DAI_POLYGON_MUMBAI,\n    },\n    [ChainId.CELO]: {\n        CELO: CELO,\n        CUSD: CUSD_CELO,\n        CEUR: CEUR_CELO,\n        DAI: DAI_CELO,\n    },\n    [ChainId.CELO_ALFAJORES]: {\n        CELO: CELO_ALFAJORES,\n        CUSD: CUSD_CELO_ALFAJORES,\n        CEUR: CUSD_CELO_ALFAJORES,\n        DAI: DAI_CELO_ALFAJORES,\n    },\n    [ChainId.GNOSIS]: {\n        WXDAI: WRAPPED_NATIVE_CURRENCY[ChainId.GNOSIS],\n        USDC_ETHEREUM_GNOSIS: USDC_ETHEREUM_GNOSIS,\n    },\n    [ChainId.MOONBEAM]: {\n        USDC: USDC_MOONBEAM,\n        DAI: DAI_MOONBEAM,\n        WBTC: WBTC_MOONBEAM,\n        WGLMR: WRAPPED_NATIVE_CURRENCY[ChainId.MOONBEAM],\n    },\n    // Currently we do not have providers for Moonbeam mainnet or Gnosis testnet\n};\n/**\n * Provider for getting token metadata that falls back to a different provider\n * in the event of failure.\n *\n * @export\n * @class CachingTokenProviderWithFallback\n */\nexport class CachingTokenProviderWithFallback {\n    constructor(chainId, \n    // Token metadata (e.g. symbol and decimals) don't change so can be cached indefinitely.\n    // Constructing a new token object is slow as sdk-core does checksumming.\n    tokenCache, primaryTokenProvider, fallbackTokenProvider) {\n        this.chainId = chainId;\n        this.tokenCache = tokenCache;\n        this.primaryTokenProvider = primaryTokenProvider;\n        this.fallbackTokenProvider = fallbackTokenProvider;\n        this.CACHE_KEY = (chainId, address) => `token-${chainId}-${address}`;\n    }\n    async getTokens(_addresses) {\n        const seedTokens = CACHE_SEED_TOKENS[this.chainId];\n        if (seedTokens) {\n            for (const token of Object.values(seedTokens)) {\n                await this.tokenCache.set(this.CACHE_KEY(this.chainId, token.address.toLowerCase()), token);\n            }\n        }\n        const addressToToken = {};\n        const symbolToToken = {};\n        const addresses = _(_addresses)\n            .map((address) => address.toLowerCase())\n            .uniq()\n            .value();\n        const addressesToFindInPrimary = [];\n        const addressesToFindInSecondary = [];\n        for (const address of addresses) {\n            if (await this.tokenCache.has(this.CACHE_KEY(this.chainId, address))) {\n                addressToToken[address.toLowerCase()] = (await this.tokenCache.get(this.CACHE_KEY(this.chainId, address)));\n                symbolToToken[addressToToken[address].symbol] =\n                    (await this.tokenCache.get(this.CACHE_KEY(this.chainId, address)));\n            }\n            else {\n                addressesToFindInPrimary.push(address);\n            }\n        }\n        log.info({ addressesToFindInPrimary }, `Found ${addresses.length - addressesToFindInPrimary.length} out of ${addresses.length} tokens in local cache. ${addressesToFindInPrimary.length > 0\n            ? `Checking primary token provider for ${addressesToFindInPrimary.length} tokens`\n            : ``}\n      `);\n        if (addressesToFindInPrimary.length > 0) {\n            const primaryTokenAccessor = await this.primaryTokenProvider.getTokens(addressesToFindInPrimary);\n            for (const address of addressesToFindInPrimary) {\n                const token = primaryTokenAccessor.getTokenByAddress(address);\n                if (token) {\n                    addressToToken[address.toLowerCase()] = token;\n                    symbolToToken[addressToToken[address].symbol] = token;\n                    await this.tokenCache.set(this.CACHE_KEY(this.chainId, address.toLowerCase()), addressToToken[address]);\n                }\n                else {\n                    addressesToFindInSecondary.push(address);\n                }\n            }\n            log.info({ addressesToFindInSecondary }, `Found ${addressesToFindInPrimary.length - addressesToFindInSecondary.length} tokens in primary. ${this.fallbackTokenProvider\n                ? `Checking secondary token provider for ${addressesToFindInSecondary.length} tokens`\n                : `No fallback token provider specified. About to return.`}`);\n        }\n        if (this.fallbackTokenProvider && addressesToFindInSecondary.length > 0) {\n            const secondaryTokenAccessor = await this.fallbackTokenProvider.getTokens(addressesToFindInSecondary);\n            for (const address of addressesToFindInSecondary) {\n                const token = secondaryTokenAccessor.getTokenByAddress(address);\n                if (token) {\n                    addressToToken[address.toLowerCase()] = token;\n                    symbolToToken[addressToToken[address].symbol] = token;\n                    await this.tokenCache.set(this.CACHE_KEY(this.chainId, address.toLowerCase()), addressToToken[address]);\n                }\n            }\n        }\n        return {\n            getTokenByAddress: (address) => {\n                return addressToToken[address.toLowerCase()];\n            },\n            getTokenBySymbol: (symbol) => {\n                return symbolToToken[symbol.toLowerCase()];\n            },\n            getAllTokens: () => {\n                return Object.values(addressToToken);\n            },\n        };\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FjaGluZy10b2tlbi1wcm92aWRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9wcm92aWRlcnMvY2FjaGluZy10b2tlbi1wcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDMUMsT0FBTyxDQUFDLE1BQU0sUUFBUSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBR2hFLE9BQU8sRUFDTCxJQUFJLEVBQ0osY0FBYyxFQUNkLFNBQVMsRUFDVCxTQUFTLEVBQ1QsbUJBQW1CLEVBQ25CLFlBQVksRUFDWixvQkFBb0IsRUFDcEIsUUFBUSxFQUNSLGtCQUFrQixFQUNsQixXQUFXLEVBQ1gsWUFBWSxFQUNaLFlBQVksRUFDWixvQkFBb0IsRUFDcEIsa0JBQWtCLEVBQ2xCLGFBQWEsRUFDYixhQUFhLEVBR2Isb0JBQW9CLEVBQ3BCLGFBQWEsRUFDYixxQkFBcUIsRUFDckIsb0JBQW9CLEVBQ3BCLFlBQVksRUFDWixhQUFhLEVBQ2IsYUFBYSxFQUNiLHFCQUFxQixFQUNyQixZQUFZLEVBQ1osYUFBYSxFQUNiLHFCQUFxQixFQUNyQixZQUFZLEVBQ1osYUFBYSxFQUNiLHFCQUFxQixFQUNyQixhQUFhLEVBQ2IsWUFBWSxFQUNaLGFBQWEsRUFDYixhQUFhLEVBQ2IscUJBQXFCLEVBQ3JCLGNBQWMsRUFDZCxxQkFBcUIsR0FDdEIsTUFBTSxrQkFBa0IsQ0FBQztBQUUxQixnRUFBZ0U7QUFDaEUsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBRTFCO0lBQ0YsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDakIsSUFBSSxFQUFFLHVCQUF1QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUU7UUFDL0MsSUFBSSxFQUFFLFlBQVk7UUFDbEIsSUFBSSxFQUFFLFlBQVk7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"]},"metadata":{},"sourceType":"module"}